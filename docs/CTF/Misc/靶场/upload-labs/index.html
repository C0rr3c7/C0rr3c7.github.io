<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CTF/Misc/靶场/upload-labs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">upload-labs | C0rr3ct</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://C0rr3c7.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://C0rr3c7.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://C0rr3c7.github.io/docs/CTF/Misc/靶场/upload-labs"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="upload-labs | C0rr3ct"><meta data-rh="true" name="description" content="文件上传漏洞被利用需要两个前提条件："><meta data-rh="true" property="og:description" content="文件上传漏洞被利用需要两个前提条件："><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://C0rr3c7.github.io/docs/CTF/Misc/靶场/upload-labs"><link data-rh="true" rel="alternate" href="https://C0rr3c7.github.io/docs/CTF/Misc/靶场/upload-labs" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://C0rr3c7.github.io/docs/CTF/Misc/靶场/upload-labs" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="C0rr3ct RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="C0rr3ct Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.aff420c1.css">
<script src="/assets/js/runtime~main.3f5cae2e.js" defer="defer"></script>
<script src="/assets/js/main.4a9d0a45.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">C0rr3rt</b></a><a class="navbar__item navbar__link" href="/docs/HackMyVm/">HackMyVm</a><a class="navbar__item navbar__link" href="/docs/VulnHub/">VulnHub</a><a class="navbar__item navbar__link" href="/docs/HackTheBox/">HackTheBox</a><a class="navbar__item navbar__link" href="/docs/category/vulnstack">VulnStack</a><a class="navbar__item navbar__link" href="/docs/category/玄机">应急响应</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/CTF/">CTF</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about">关于</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/CTF/">CTF</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/ciscnccb">ciscn&amp;&amp;ccb</a><button aria-label="展开侧边栏分类 &#x27;ciscn&amp;&amp;ccb&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/buuctf">BUUCTF</a><button aria-label="展开侧边栏分类 &#x27;BUUCTF&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/ctfshow">CTFSHOW</a><button aria-label="展开侧边栏分类 &#x27;CTFSHOW&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/misc">Misc</a><button aria-label="折叠侧边栏分类 &#x27;Misc&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/靶场">靶场</a><button aria-label="折叠侧边栏分类 &#x27;靶场&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/靶场/pikachu">pikachu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/靶场/sqli-labs">sqli-labs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CTF/Misc/靶场/upload-labs">upload-labs</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/2022鹏程杯-web">2022鹏程杯-web</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/2023蓝帽杯Love PHP">2023蓝帽杯Love PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/2024强网复现">2024强网复现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/2024红明谷">2024红明谷</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/NSSCTF Round-20 Basic个人WEB专场">NSSCTF Round-20 Basic个人WEB专场</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/NewStarCTF2023">NewStarCTF2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/Nodejs常见漏洞">Nodejs常见漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/PHP之preg-match绕过">PHP之preg-match绕过</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/PHP反序列化">PHP反序列化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/SHCTF2023">SHCTF2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/ctf-nodejs">ctf-nodejs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/ctf-python">ctf-python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/nss">鹤城杯 2021EasyP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/安洵杯2019-easy_serialize_php">安洵杯2019-easy_serialize_php</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/第三届黄河流域公安院校网络安全技能挑战赛">第三届黄河流域公安院校网络安全技能挑战赛</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/网鼎杯2018-Fakebook">网鼎杯2018-Fakebook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CTF/Misc/羊城杯2020">羊城杯2020</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/misc"><span itemprop="name">Misc</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/靶场"><span itemprop="name">靶场</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">upload-labs</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>upload-labs</h1></header><p>文件上传漏洞被利用需要<strong>两个前提条件</strong>：</p>
<p>1、文件能上传成功</p>
<p>2、攻击者能知道文件路径</p>
<p>凡是上传图片并显示的关卡，都有<strong>三种方式可以知道文件路径</strong></p>
<p>1、最简单直接的，在没显示出来的图片上右键选择“复制图像链接”，可以得到文件的绝对路径</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/123c53e523fa4a86aa967a84de16ba67.png" alt="123c53e523fa4a86aa967a84de16ba67" class="img_ev3q"></p>
<p>2、网页上右键选择“查看页面源代码”，源代码中显示文件的相对路径</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407135835211.png" alt="image-20230407135835211" class="img_ev3q"></p>
<p>3、如果是用burpsuite上传的文件，response报文中也会显示文件的相对路径。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-01前端验证">Pass-01(前端验证)<a href="#pass-01前端验证" class="hash-link" aria-label="Pass-01(前端验证)的直接链接" title="Pass-01(前端验证)的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法1">方法1：<a href="#方法1" class="hash-link" aria-label="方法1：的直接链接" title="方法1：的直接链接">​</a></h3>
<p><code>浏览器disable JS</code></p>
<p>firefox可以安装一个叫Script Switch的插件，安装成功之后，就是下图右上角小红框里那个图标，使其处在JS disabled状态，上传x.php。出现下图这样没加载成功的图片表示webshell已经上传成功。</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/92b2e5477ba24b1eabbe94cf11f0b4a0.png" alt="92b2e5477ba24b1eabbe94cf11f0b4a0" class="img_ev3q"></p>
<p>到服务器上看看，上传成功的webshell在 <strong>upload-labs目录\upload</strong> 文件夹下</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="方法2">方法2：<a href="#方法2" class="hash-link" aria-label="方法2：的直接链接" title="方法2：的直接链接">​</a></h3>
<p>bp抓包修改后缀</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/b6b05f1cc2d749eea3164807c384fe7f.png" alt="b6b05f1cc2d749eea3164807c384fe7f" class="img_ev3q"></p>
<p>蚁剑连接即可看到文件已经上传</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-02contenttype">Pass-02(ContentType)<a href="#pass-02contenttype" class="hash-link" aria-label="Pass-02(ContentType)的直接链接" title="Pass-02(ContentType)的直接链接">​</a></h2>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;image/jpeg&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;image/png&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;image/gif&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>第二关主要是对MIME进行检查（ContentType），直接修改为上面的三种类型就可以</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-03修改httpdini">Pass-03(修改httpd.ini)<a href="#pass-03修改httpdini" class="hash-link" aria-label="Pass-03(修改httpd.ini)的直接链接" title="Pass-03(修改httpd.ini)的直接链接">​</a></h2>
<p>姿势一：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以进行双写绕过<code>::$DA::$DATATA</code></p>
<p>首先上传个1.php，发现页面提示是”不允许上传……后缀文件“，并且burpsuite有抓到包，初步判断，这关可能是后端文件后缀黑名单过滤。</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407140010914.png" alt="image-20230407140010914" class="img_ev3q"></p>
<p>payload写一些有可能被解析为php的文件后缀的字符，大小写绕过，双写绕过，一些利用操作系统特性（比如服务器是windows系统的话，结尾加点，加空格，加::$DATA，后缀某几个字母大写）</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407141147135.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407141107881.png" alt="image-20230407141107881" class="img_ev3q"></p>
<p>上图的文件后缀是正常的，是有用的，用webshell管理工具连接的时候，文件名写202304071406293829.php就行</p>
<p>姿势二：</p>
<p>修改httpd.ini配置文件，将<code>.php3,,php5,,phtml</code>作为php文件</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231121222945950.png" alt="image-20231121222945950" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-04htaccess">Pass-04(.htaccess)<a href="#pass-04htaccess" class="hash-link" aria-label="Pass-04(.htaccess)的直接链接" title="Pass-04(.htaccess)的直接链接">​</a></h2>
<p>姿势一：</p>
<p>把后缀改成png之后，可以上传成功。可以初步判断，本关不检查文件内容，检查点应该在<strong>Content-Type</strong>或者<strong>文件后缀</strong>，或者两者都有。</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407145704699.png" alt="image-20230407145704699" class="img_ev3q"></p>
<p>先看看Content-Type有无影响。把Content-Type从image/png改成application/octet-stream，发送之后，发现文件依然能上传成功，说明本关Content-Type无影响。</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407145850092.png" alt="image-20230407145850092" class="img_ev3q"></p>
<p>接下来判断一下文件后缀是黑名单过滤还是白名单过滤：</p>
<p>文件后缀改成.xxx，发送后发现文件上传成功，说明本关还是文件后缀黑名单过滤</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407145939292.png" alt="image-20230407145939292" class="img_ev3q"></p>
<p>HTTP EXP：将文件后缀名改为“<strong>点+空格+点</strong>”的格式，这样<strong>file_ext会变为空</strong>，成功绕过黑名单上传。<strong>Windows会自动删除文件名最后的点</strong>，最后变为2.php。</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407151322154.png" alt="image-20230407151322154" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Content-Disposition: form-data; name=&quot;upload_file&quot;; filename=&quot;2.php. .&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>姿势二：</p>
<p>上传<code>.htaccess</code>文件(分布式配置文件)，优先等级高于http.ini，它的作用范围是本目录和其子目录</p>
<p>修改配置文件http.ini,将none改为All，允许.htaccess文件生效</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231121224302274.png" alt="image-20231121224302274" class="img_ev3q"></p>
<p>·htaccess文件内容</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AddType application/x-httpd-php .png //.png文件当作php文件执行</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>访问.png文件即可</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-05userini">Pass-05(.user.ini)<a href="#pass-05userini" class="hash-link" aria-label="Pass-05(.user.ini)的直接链接" title="Pass-05(.user.ini)的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主要源码">主要源码<a href="#主要源码" class="hash-link" aria-label="主要源码的直接链接" title="主要源码的直接链接">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">$is_upload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_POST</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;submit&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">file_exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UPLOAD_PATH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$deny_ext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string double-quoted-string" style="color:#e3116c">&quot;省略了&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//后缀数组，如.php,.phtml等</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$file_name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//去除文件名首尾空格</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$file_name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">deldot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">//删除文件名末尾的点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strrchr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//返回.在文件名中最后一次出现的位置，并返回从该位置到字符串结尾的所有字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strtolower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//转换为小写</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">str_ireplace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;::$DATA&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">//去除字符串::$DATA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//首尾去空</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">in_array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$deny_ext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token variable" style="color:#36acaa">$temp_file</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;tmp_name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//临时目录文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token variable" style="color:#36acaa">$img_path</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UPLOAD_PATH</span><span class="token operator" style="color:#393A34">.</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token operator" style="color:#393A34">.</span><span class="token variable" style="color:#36acaa">$file_name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//保存目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">move_uploaded_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$temp_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//移动临时文件到保存目录，移动成功返回True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token variable" style="color:#36acaa">$is_upload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;上传出错！&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;此文件类型不允许上传！&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UPLOAD_PATH</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;文件夹不存在,请手工创建！&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>姿势一：</p>
<p>和Pass-04一样，代码中只过滤了一次点，删除了空格和::$DATA，将文件后缀改为小写，黑名单等，使用Pass-04的方法绕过即可。但黑名单中屏蔽了.htaccess文件。</p>
<p>HTTP EXP：文件名改为“2.php. . ”。</p>
<p>姿势二：</p>
<p>利用<code>.user.ini</code>文件，优先级高于php.ini</p>
<p>生效条件：上传目录里必须有php文件，serverAPI要是CGI/FastCGI （phpinfo可以进行查看）</p>
<table><thead><tr><th>Server API</th><th>CGI/FastCGI</th></tr></thead></table>
<p>内容</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auto_prepend_file=info.png       //php文件包含info.png</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-6大小写绕过windows下">Pass-6(大小写绕过windows下)<a href="#pass-6大小写绕过windows下" class="hash-link" aria-label="Pass-6(大小写绕过windows下)的直接链接" title="Pass-6(大小写绕过windows下)的直接链接">​</a></h2>
<p>与上一关比较，少了一个将后缀转小写的操作</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$file_ext = strtolower($file_ext); //转换为小写</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因为windows系统对将<code>.Php</code>转变成<code>.php</code>，导致代码执行成功</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-7空格绕过windows下">Pass-7(空格绕过windows下)<a href="#pass-7空格绕过windows下" class="hash-link" aria-label="Pass-7(空格绕过windows下)的直接链接" title="Pass-7(空格绕过windows下)的直接链接">​</a></h2>
<p>少了一个首尾去空的函数</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$file_ext = trim($file_ext); //首尾去空</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>直接在后缀后面加一个空格就行，因为windows系统特性会将文件后面空格删掉</p>
<p>抓包加空格</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231122200101759.png" alt="image-20231122200101759" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-8点绕过windows下">Pass-8(点绕过windows下)<a href="#pass-8点绕过windows下" class="hash-link" aria-label="Pass-8(点绕过windows下)的直接链接" title="Pass-8(点绕过windows下)的直接链接">​</a></h2>
<p>少了一个deldot函数</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$file_name = deldot($file_name);//删除文件名末尾的点</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那我们可以在后缀加上点，就能绕过，操作同上</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-9datawindows下">Pass-9(::$DATAwindows下)<a href="#pass-9datawindows下" class="hash-link" aria-label="Pass-9(::$DATAwindows下)的直接链接" title="Pass-9(::$DATAwindows下)的直接链接">​</a></h2>
<p>在window的时候如果文件名+<code>&quot;::$DATA&quot;</code>会把<code>::$DATA</code>之后的数据当成文件流处理,不会检测后缀名，且保持<code>::$DATA</code>之前的文件名，他的目的就是不检查后缀名</p>
<p>目录里有一个1.txt文件</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo 456&gt;1.txt:2.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notepad 1.txt:2.txt  //查看额外数据流</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231122203818851.png" alt="image-20231122203818851" class="img_ev3q"></p>
<p>原1.txt的内容是不受影响的</p>
<p>我们在文件名加上<code>::$DATA</code>，上传就行</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-10点空格点绕过windows下">Pass-10(点空格点绕过windows下)<a href="#pass-10点空格点绕过windows下" class="hash-link" aria-label="Pass-10(点空格点绕过windows下)的直接链接" title="Pass-10(点空格点绕过windows下)的直接链接">​</a></h2>
<p>看了源码，发现这些函数只验证一次，例如删除文件末尾的点</p>
<p>点空格点为什么能绕过？</p>
<p>有一个文件<code>1.php. .</code></p>
<p>首先deldot函数会去掉末尾的一个点，变成<code>1.php. </code></p>
<p>strrchr函数取的后缀是<code>. </code>,然后去掉后面的<code>.</code>，后缀就剩一个.了（不在黑名单中）</p>
<p>最后上传文件名是<code>1.php. </code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-11双写绕过">Pass-11(双写绕过)<a href="#pass-11双写绕过" class="hash-link" aria-label="Pass-11(双写绕过)的直接链接" title="Pass-11(双写绕过)的直接链接">​</a></h2>
<p>源码变了，但依旧是黑名单</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name); //文件名里有黑名单的后缀就会被替换成空</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>构造一个文件名<code>1.pphphp</code>，它是从左到右序列替换的，替换后变成1.php</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231122210501403.png" alt="image-20231122210501403" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-1200截断">Pass-12(%00截断)<a href="#pass-1200截断" class="hash-link" aria-label="Pass-12(%00截断)的直接链接" title="Pass-12(%00截断)的直接链接">​</a></h2>
<p>源码变了</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">$is_upload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_POST</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;submit&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token variable" style="color:#36acaa">$ext_arr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;jpg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;png&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;gif&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//白名单，允许上传的文件类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token function" style="color:#d73a49">strrpos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string double-quoted-string" style="color:#e3116c">&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">in_array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">$ext_arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$temp_file</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$_FILES</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;upload_file&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;tmp_name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$img_path</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$_GET</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;save_path&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">.</span><span class="token string double-quoted-string" style="color:#e3116c">&quot;/&quot;</span><span class="token operator" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">99</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string double-quoted-string" style="color:#e3116c">&quot;YmdHis&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">.</span><span class="token string double-quoted-string" style="color:#e3116c">&quot;.&quot;</span><span class="token operator" style="color:#393A34">.</span><span class="token variable" style="color:#36acaa">$file_ext</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">move_uploaded_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$temp_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">$img_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token variable" style="color:#36acaa">$is_upload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;上传出错！&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token variable" style="color:#36acaa">$msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string double-quoted-string" style="color:#e3116c">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>save_path是一个可控变量，用%00进行截断，使用条件：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">php版本小于5.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php的magic_quotes_gpc为OFF状态</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上传.png图片</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123112643645.png" alt="image-20231123112643645" class="img_ev3q"></p>
<p>上传后url地址是这样的</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123113120815.png" alt="image-20231123113120815" class="img_ev3q"></p>
<p>我们访问1.php就行了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-130x00绕过">Pass-13(0x00绕过)<a href="#pass-130x00绕过" class="hash-link" aria-label="Pass-13(0x00绕过)的直接链接" title="Pass-13(0x00绕过)的直接链接">​</a></h2>
<p>同样save_path是可控的，这个是post请求</p>
<p>在文件名后面随便加个字符，将它的hex编码改成00</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123113614521.png" alt="image-20231123113614521" class="img_ev3q"></p>
<p>访问同上</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-14图片">Pass-14(图片🐎)<a href="#pass-14图片" class="hash-link" aria-label="Pass-14(图片🐎)的直接链接" title="Pass-14(图片🐎)的直接链接">​</a></h2>
<p>准备php文件(里面是一句话木马)，和一张普通图片</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">copy 13.jpg /b + 13.php webshell.jpg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上传图片后，利用文件包含漏洞进行执行</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123115055264.png" alt="image-20231123115055264" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-15图片">Pass-15(图片🐎)<a href="#pass-15图片" class="hash-link" aria-label="Pass-15(图片🐎)的直接链接" title="Pass-15(图片🐎)的直接链接">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$info = getimagesize($filename);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>getimagesize()是PHP中用于获取图像的大小和格式的函数。它可以返回一个包含图像的宽度、高度、类型和MIME类型的数组</p>
<p>getimagesize()的基本语法如下：</p>
<p>$size = getimagesize($filename);</p>
<p>其中，$filename是要获取信息的图像文件的路径。该函数返回一个数组$size，数组元素如下：</p>
<p>$size[0]: 图像的宽度
$size[1]: 图像的高度
$size[2]: 图像的类型
$size[3]: 图像的MIME类型
$size[bits]: 图像的位深度
$size[channels]: 图像的通道数
$size[mime]: 图像的MIME类型</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [0] =&gt; 592</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [1] =&gt; 387</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [2] =&gt; 3 //一个代表图像类型的整数值，常量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [3] =&gt; width=&quot;592&quot; height=&quot;387&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [bits] =&gt; 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [mime] =&gt; image/png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该值有如下常量：</p>
<p>IMAGETYPE_GIF: GIF格式
IMAGETYPE_JPEG: JPEG格式
IMAGETYPE_PNG: PNG格式</p>
<p>上面的3就代表是png格式的图片</p>
<p>同样图片马绕过</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-16exif_imagetype">Pass-16(exif_imagetype)<a href="#pass-16exif_imagetype" class="hash-link" aria-label="Pass-16(exif_imagetype)的直接链接" title="Pass-16(exif_imagetype)的直接链接">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//需要开启php_exif模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$image_type = exif_imagetype($filename);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//exif_imagetype()仅检查文件的前几个字节，图片码可以绕过</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上传包含一句话木马的图片，然后利用文件包含漏洞执行代码</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-17二次渲染">Pass-17(二次渲染)<a href="#pass-17二次渲染" class="hash-link" aria-label="Pass-17(二次渲染)的直接链接" title="Pass-17(二次渲染)的直接链接">​</a></h2>
<p>有二次渲染函数</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">imagecreatefromjpeg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imagecreatefrompng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imagecreatefromgif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上传图片马之后，会将文件最后的php代码删掉</p>
<p>我们可以先上传图片马，然后用010和被渲染的图片进行对比，找到一样的部分（未被渲染的部分）</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231211201726976.png" alt="image-20231211201726976" class="img_ev3q"></p>
<p>再上传就可以了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pass-18条件竞争">Pass-18(条件竞争)<a href="#pass-18条件竞争" class="hash-link" aria-label="Pass-18(条件竞争)的直接链接" title="Pass-18(条件竞争)的直接链接">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">unlink($upload_file); //文件类型不合规直接会被删除</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以多开几个线程，在还没删除之前就执行代码</p>
<p>抓包上传php文件，开两个爆破页面，一个写，一个读</p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231211221940410.png" alt="image-20231211221940410" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231211221951213.png" alt="image-20231211221951213" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/C0rr3c7/C0rr3c7.github.io/tree/master/docs/CTF/Misc/靶场/upload-labs.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CTF/Misc/靶场/sqli-labs"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">sqli-labs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CTF/Misc/2022鹏程杯-web"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">2022鹏程杯-web</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pass-01前端验证" class="table-of-contents__link toc-highlight">Pass-01(前端验证)</a><ul><li><a href="#方法1" class="table-of-contents__link toc-highlight">方法1：</a></li><li><a href="#方法2" class="table-of-contents__link toc-highlight">方法2：</a></li></ul></li><li><a href="#pass-02contenttype" class="table-of-contents__link toc-highlight">Pass-02(ContentType)</a></li><li><a href="#pass-03修改httpdini" class="table-of-contents__link toc-highlight">Pass-03(修改httpd.ini)</a></li><li><a href="#pass-04htaccess" class="table-of-contents__link toc-highlight">Pass-04(.htaccess)</a></li><li><a href="#pass-05userini" class="table-of-contents__link toc-highlight">Pass-05(.user.ini)</a><ul><li><a href="#主要源码" class="table-of-contents__link toc-highlight">主要源码</a></li></ul></li><li><a href="#pass-6大小写绕过windows下" class="table-of-contents__link toc-highlight">Pass-6(大小写绕过windows下)</a></li><li><a href="#pass-7空格绕过windows下" class="table-of-contents__link toc-highlight">Pass-7(空格绕过windows下)</a></li><li><a href="#pass-8点绕过windows下" class="table-of-contents__link toc-highlight">Pass-8(点绕过windows下)</a></li><li><a href="#pass-9datawindows下" class="table-of-contents__link toc-highlight">Pass-9(::$DATAwindows下)</a></li><li><a href="#pass-10点空格点绕过windows下" class="table-of-contents__link toc-highlight">Pass-10(点空格点绕过windows下)</a></li><li><a href="#pass-11双写绕过" class="table-of-contents__link toc-highlight">Pass-11(双写绕过)</a></li><li><a href="#pass-1200截断" class="table-of-contents__link toc-highlight">Pass-12(%00截断)</a></li><li><a href="#pass-130x00绕过" class="table-of-contents__link toc-highlight">Pass-13(0x00绕过)</a></li><li><a href="#pass-14图片" class="table-of-contents__link toc-highlight">Pass-14(图片🐎)</a></li><li><a href="#pass-15图片" class="table-of-contents__link toc-highlight">Pass-15(图片🐎)</a></li><li><a href="#pass-16exif_imagetype" class="table-of-contents__link toc-highlight">Pass-16(exif_imagetype)</a></li><li><a href="#pass-17二次渲染" class="table-of-contents__link toc-highlight">Pass-17(二次渲染)</a></li><li><a href="#pass-18条件竞争" class="table-of-contents__link toc-highlight">Pass-18(条件竞争)</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Blog, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>