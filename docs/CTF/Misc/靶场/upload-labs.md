æ–‡ä»¶ä¸Šä¼ æ¼æ´è¢«åˆ©ç”¨éœ€è¦**ä¸¤ä¸ªå‰ææ¡ä»¶**ï¼š

1ã€æ–‡ä»¶èƒ½ä¸Šä¼ æˆåŠŸ

2ã€æ”»å‡»è€…èƒ½çŸ¥é“æ–‡ä»¶è·¯å¾„

å‡¡æ˜¯ä¸Šä¼ å›¾ç‰‡å¹¶æ˜¾ç¤ºçš„å…³å¡ï¼Œéƒ½æœ‰**ä¸‰ç§æ–¹å¼å¯ä»¥çŸ¥é“æ–‡ä»¶è·¯å¾„**

1ã€æœ€ç®€å•ç›´æ¥çš„ï¼Œåœ¨æ²¡æ˜¾ç¤ºå‡ºæ¥çš„å›¾ç‰‡ä¸Šå³é”®é€‰æ‹©â€œå¤åˆ¶å›¾åƒé“¾æ¥â€ï¼Œå¯ä»¥å¾—åˆ°æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

![123c53e523fa4a86aa967a84de16ba67](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/123c53e523fa4a86aa967a84de16ba67.png)

2ã€ç½‘é¡µä¸Šå³é”®é€‰æ‹©â€œæŸ¥çœ‹é¡µé¢æºä»£ç â€ï¼Œæºä»£ç ä¸­æ˜¾ç¤ºæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„

![image-20230407135835211](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407135835211.png)

3ã€å¦‚æœæ˜¯ç”¨burpsuiteä¸Šä¼ çš„æ–‡ä»¶ï¼ŒresponseæŠ¥æ–‡ä¸­ä¹Ÿä¼šæ˜¾ç¤ºæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ã€‚

## Pass-01(å‰ç«¯éªŒè¯)

### æ–¹æ³•1ï¼š

`æµè§ˆå™¨disable JS`

firefoxå¯ä»¥å®‰è£…ä¸€ä¸ªå«Script Switchçš„æ’ä»¶ï¼Œå®‰è£…æˆåŠŸä¹‹åï¼Œå°±æ˜¯ä¸‹å›¾å³ä¸Šè§’å°çº¢æ¡†é‡Œé‚£ä¸ªå›¾æ ‡ï¼Œä½¿å…¶å¤„åœ¨JS disabledçŠ¶æ€ï¼Œä¸Šä¼ x.phpã€‚å‡ºç°ä¸‹å›¾è¿™æ ·æ²¡åŠ è½½æˆåŠŸçš„å›¾ç‰‡è¡¨ç¤ºwebshellå·²ç»ä¸Šä¼ æˆåŠŸã€‚

![92b2e5477ba24b1eabbe94cf11f0b4a0](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/92b2e5477ba24b1eabbe94cf11f0b4a0.png)



åˆ°æœåŠ¡å™¨ä¸Šçœ‹çœ‹ï¼Œä¸Šä¼ æˆåŠŸçš„webshellåœ¨ **upload-labsç›®å½•\upload** æ–‡ä»¶å¤¹ä¸‹

### æ–¹æ³•2ï¼š

 bpæŠ“åŒ…ä¿®æ”¹åç¼€

![b6b05f1cc2d749eea3164807c384fe7f](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/b6b05f1cc2d749eea3164807c384fe7f.png)

èšå‰‘è¿æ¥å³å¯çœ‹åˆ°æ–‡ä»¶å·²ç»ä¸Šä¼ 

## Pass-02(ContentType)
```php
if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif'))
```

ç¬¬äºŒå…³ä¸»è¦æ˜¯å¯¹MIMEè¿›è¡Œæ£€æŸ¥ï¼ˆContentTypeï¼‰ï¼Œç›´æ¥ä¿®æ”¹ä¸ºä¸Šé¢çš„ä¸‰ç§ç±»å‹å°±å¯ä»¥

## Pass-03(ä¿®æ”¹httpd.ini)

å§¿åŠ¿ä¸€ï¼š

```
$file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
```

å¯ä»¥è¿›è¡ŒåŒå†™ç»•è¿‡`::$DA::$DATATA`

é¦–å…ˆä¸Šä¼ ä¸ª1.phpï¼Œå‘ç°é¡µé¢æç¤ºæ˜¯â€ä¸å…è®¸ä¸Šä¼ â€¦â€¦åç¼€æ–‡ä»¶â€œï¼Œå¹¶ä¸”burpsuiteæœ‰æŠ“åˆ°åŒ…ï¼Œåˆæ­¥åˆ¤æ–­ï¼Œè¿™å…³å¯èƒ½æ˜¯åç«¯æ–‡ä»¶åç¼€é»‘åå•è¿‡æ»¤ã€‚

![image-20230407140010914](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407140010914.png)

payloadå†™ä¸€äº›æœ‰å¯èƒ½è¢«è§£æä¸ºphpçš„æ–‡ä»¶åç¼€çš„å­—ç¬¦ï¼Œå¤§å°å†™ç»•è¿‡ï¼ŒåŒå†™ç»•è¿‡ï¼Œä¸€äº›åˆ©ç”¨æ“ä½œç³»ç»Ÿç‰¹æ€§ï¼ˆæ¯”å¦‚æœåŠ¡å™¨æ˜¯windowsç³»ç»Ÿçš„è¯ï¼Œç»“å°¾åŠ ç‚¹ï¼ŒåŠ ç©ºæ ¼ï¼ŒåŠ ::$DATAï¼Œåç¼€æŸå‡ ä¸ªå­—æ¯å¤§å†™ï¼‰

![](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407141147135.png)

![image-20230407141107881](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407141107881.png)

ä¸Šå›¾çš„æ–‡ä»¶åç¼€æ˜¯æ­£å¸¸çš„ï¼Œæ˜¯æœ‰ç”¨çš„ï¼Œç”¨webshellç®¡ç†å·¥å…·è¿æ¥çš„æ—¶å€™ï¼Œæ–‡ä»¶åå†™202304071406293829.phpå°±è¡Œ

å§¿åŠ¿äºŒï¼š

ä¿®æ”¹httpd.inié…ç½®æ–‡ä»¶ï¼Œå°†`.php3,,php5,,phtml`ä½œä¸ºphpæ–‡ä»¶

![image-20231121222945950](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231121222945950.png)

## Pass-04(.htaccess)

å§¿åŠ¿ä¸€ï¼š

æŠŠåç¼€æ”¹æˆpngä¹‹åï¼Œå¯ä»¥ä¸Šä¼ æˆåŠŸã€‚å¯ä»¥åˆæ­¥åˆ¤æ–­ï¼Œæœ¬å…³ä¸æ£€æŸ¥æ–‡ä»¶å†…å®¹ï¼Œæ£€æŸ¥ç‚¹åº”è¯¥åœ¨**Content-Type**æˆ–è€…**æ–‡ä»¶åç¼€**ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ã€‚

![image-20230407145704699](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407145704699.png)

å…ˆçœ‹çœ‹Content-Typeæœ‰æ— å½±å“ã€‚æŠŠContent-Typeä»image/pngæ”¹æˆapplication/octet-streamï¼Œå‘é€ä¹‹åï¼Œå‘ç°æ–‡ä»¶ä¾ç„¶èƒ½ä¸Šä¼ æˆåŠŸï¼Œè¯´æ˜æœ¬å…³Content-Typeæ— å½±å“ã€‚

![image-20230407145850092](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407145850092.png)

æ¥ä¸‹æ¥åˆ¤æ–­ä¸€ä¸‹æ–‡ä»¶åç¼€æ˜¯é»‘åå•è¿‡æ»¤è¿˜æ˜¯ç™½åå•è¿‡æ»¤ï¼š

æ–‡ä»¶åç¼€æ”¹æˆ.xxxï¼Œå‘é€åå‘ç°æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œè¯´æ˜æœ¬å…³è¿˜æ˜¯æ–‡ä»¶åç¼€é»‘åå•è¿‡æ»¤

![image-20230407145939292](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407145939292.png)

HTTP EXPï¼šå°†æ–‡ä»¶åç¼€åæ”¹ä¸ºâ€œ**ç‚¹+ç©ºæ ¼+ç‚¹**â€çš„æ ¼å¼ï¼Œè¿™æ ·**file_extä¼šå˜ä¸ºç©º**ï¼ŒæˆåŠŸç»•è¿‡é»‘åå•ä¸Šä¼ ã€‚**Windowsä¼šè‡ªåŠ¨åˆ é™¤æ–‡ä»¶åæœ€åçš„ç‚¹**ï¼Œæœ€åå˜ä¸º2.phpã€‚

![image-20230407151322154](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20230407151322154.png)

```
Content-Disposition: form-data; name="upload_file"; filename="2.php. ."
```

å§¿åŠ¿äºŒï¼š

ä¸Šä¼ `.htaccess`æ–‡ä»¶(åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶)ï¼Œä¼˜å…ˆç­‰çº§é«˜äºhttp.iniï¼Œå®ƒçš„ä½œç”¨èŒƒå›´æ˜¯æœ¬ç›®å½•å’Œå…¶å­ç›®å½•

ä¿®æ”¹é…ç½®æ–‡ä»¶http.ini,å°†noneæ”¹ä¸ºAllï¼Œå…è®¸.htaccessæ–‡ä»¶ç”Ÿæ•ˆ

![image-20231121224302274](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231121224302274.png)

Â·htaccessæ–‡ä»¶å†…å®¹

```
AddType application/x-httpd-php .png //.pngæ–‡ä»¶å½“ä½œphpæ–‡ä»¶æ‰§è¡Œ
```

è®¿é—®.pngæ–‡ä»¶å³å¯

## Pass-05(.user.ini)

### ä¸»è¦æºç 

```php
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array("çœç•¥äº†"); //åç¼€æ•°ç»„ï¼Œå¦‚.php,.phtmlç­‰
        $file_name = trim($_FILES['upload_file']['name']); //å»é™¤æ–‡ä»¶åé¦–å°¾ç©ºæ ¼
        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
        $file_ext = strrchr($file_name, '.'); //è¿”å›.åœ¨æ–‡ä»¶åä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦
        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º
        if (!in_array($file_ext, $deny_ext)) {
            $temp_file = $_FILES['upload_file']['tmp_name'];  //ä¸´æ—¶ç›®å½•æ–‡ä»¶å
            $img_path = UPLOAD_PATH.'/'.$file_name;  //ä¿å­˜ç›®å½•
            if (move_uploaded_file($temp_file, $img_path)) { //ç§»åŠ¨ä¸´æ—¶æ–‡ä»¶åˆ°ä¿å­˜ç›®å½•ï¼Œç§»åŠ¨æˆåŠŸè¿”å›True
                $is_upload = true;
            } else {
                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';
            }
        } else {
            $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼';
        }
    } else {
        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';
    }
}
```

å§¿åŠ¿ä¸€ï¼š

å’ŒPass-04ä¸€æ ·ï¼Œä»£ç ä¸­åªè¿‡æ»¤äº†ä¸€æ¬¡ç‚¹ï¼Œåˆ é™¤äº†ç©ºæ ¼å’Œ::$DATAï¼Œå°†æ–‡ä»¶åç¼€æ”¹ä¸ºå°å†™ï¼Œé»‘åå•ç­‰ï¼Œä½¿ç”¨Pass-04çš„æ–¹æ³•ç»•è¿‡å³å¯ã€‚ä½†é»‘åå•ä¸­å±è”½äº†.htaccessæ–‡ä»¶ã€‚

HTTP EXPï¼šæ–‡ä»¶åæ”¹ä¸ºâ€œ2.php. . â€ã€‚

å§¿åŠ¿äºŒï¼š

åˆ©ç”¨`.user.ini`æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºphp.ini

ç”Ÿæ•ˆæ¡ä»¶ï¼šä¸Šä¼ ç›®å½•é‡Œå¿…é¡»æœ‰phpæ–‡ä»¶ï¼ŒserverAPIè¦æ˜¯CGI/FastCGI ï¼ˆphpinfoå¯ä»¥è¿›è¡ŒæŸ¥çœ‹ï¼‰

| Server API | CGI/FastCGI |
| ---------- | ----------- |

å†…å®¹

```
auto_prepend_file=info.png       //phpæ–‡ä»¶åŒ…å«info.png
```

## Pass-6(å¤§å°å†™ç»•è¿‡windowsä¸‹)

ä¸ä¸Šä¸€å…³æ¯”è¾ƒï¼Œå°‘äº†ä¸€ä¸ªå°†åç¼€è½¬å°å†™çš„æ“ä½œ

```
$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
```

å› ä¸ºwindowsç³»ç»Ÿå¯¹å°†`.Php`è½¬å˜æˆ`.php`ï¼Œå¯¼è‡´ä»£ç æ‰§è¡ŒæˆåŠŸ

## Pass-7(ç©ºæ ¼ç»•è¿‡windowsä¸‹)

å°‘äº†ä¸€ä¸ªé¦–å°¾å»ç©ºçš„å‡½æ•°

```
$file_ext = trim($file_ext); //é¦–å°¾å»ç©º
```

ç›´æ¥åœ¨åç¼€åé¢åŠ ä¸€ä¸ªç©ºæ ¼å°±è¡Œï¼Œå› ä¸ºwindowsç³»ç»Ÿç‰¹æ€§ä¼šå°†æ–‡ä»¶åé¢ç©ºæ ¼åˆ æ‰

æŠ“åŒ…åŠ ç©ºæ ¼

![image-20231122200101759](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231122200101759.png)

## Pass-8(ç‚¹ç»•è¿‡windowsä¸‹)

å°‘äº†ä¸€ä¸ªdeldotå‡½æ•°

```
$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
```

é‚£æˆ‘ä»¬å¯ä»¥åœ¨åç¼€åŠ ä¸Šç‚¹ï¼Œå°±èƒ½ç»•è¿‡ï¼Œæ“ä½œåŒä¸Š

## Pass-9(::$DATAwindowsä¸‹)

åœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+`"::$DATA"`ä¼šæŠŠ`::$DATA`ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ`::$DATA`ä¹‹å‰çš„æ–‡ä»¶åï¼Œä»–çš„ç›®çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€å

ç›®å½•é‡Œæœ‰ä¸€ä¸ª1.txtæ–‡ä»¶

```
echo 456>1.txt:2.txt
notepad 1.txt:2.txt  //æŸ¥çœ‹é¢å¤–æ•°æ®æµ
```

![image-20231122203818851](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231122203818851.png)

åŸ1.txtçš„å†…å®¹æ˜¯ä¸å—å½±å“çš„

æˆ‘ä»¬åœ¨æ–‡ä»¶ååŠ ä¸Š`::$DATA`ï¼Œä¸Šä¼ å°±è¡Œ

## Pass-10(ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡windowsä¸‹)

çœ‹äº†æºç ï¼Œå‘ç°è¿™äº›å‡½æ•°åªéªŒè¯ä¸€æ¬¡ï¼Œä¾‹å¦‚åˆ é™¤æ–‡ä»¶æœ«å°¾çš„ç‚¹

ç‚¹ç©ºæ ¼ç‚¹ä¸ºä»€ä¹ˆèƒ½ç»•è¿‡ï¼Ÿ

æœ‰ä¸€ä¸ªæ–‡ä»¶`1.php. .`

é¦–å…ˆdeldotå‡½æ•°ä¼šå»æ‰æœ«å°¾çš„ä¸€ä¸ªç‚¹ï¼Œå˜æˆ`1.php. `

strrchrå‡½æ•°å–çš„åç¼€æ˜¯`. `,ç„¶åå»æ‰åé¢çš„`.`ï¼Œåç¼€å°±å‰©ä¸€ä¸ª.äº†ï¼ˆä¸åœ¨é»‘åå•ä¸­ï¼‰

æœ€åä¸Šä¼ æ–‡ä»¶åæ˜¯`1.php. `

## Pass-11(åŒå†™ç»•è¿‡)

æºç å˜äº†ï¼Œä½†ä¾æ—§æ˜¯é»‘åå•

```
$file_name = str_ireplace($deny_ext,"", $file_name); //æ–‡ä»¶åé‡Œæœ‰é»‘åå•çš„åç¼€å°±ä¼šè¢«æ›¿æ¢æˆç©º
```

æ„é€ ä¸€ä¸ªæ–‡ä»¶å`1.pphphp`ï¼Œå®ƒæ˜¯ä»å·¦åˆ°å³åºåˆ—æ›¿æ¢çš„ï¼Œæ›¿æ¢åå˜æˆ1.php

![image-20231122210501403](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231122210501403.png)

## Pass-12(%00æˆªæ–­)

æºç å˜äº†

```php
$is_upload = false;
$msg = null;
if(isset($_POST['submit'])){
    $ext_arr = array('jpg','png','gif'); //ç™½åå•ï¼Œå…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹
    $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],".")+1);
    if(in_array($file_ext,$ext_arr)){
        $temp_file = $_FILES['upload_file']['tmp_name'];
        $img_path = $_GET['save_path']."/".rand(10, 99).date("YmdHis").".".$file_ext;
        if(move_uploaded_file($temp_file,$img_path)){
            $is_upload = true;
        } else {
            $msg = 'ä¸Šä¼ å‡ºé”™ï¼';
        }
    } else{
        $msg = "åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼";
    }
}
```

save_pathæ˜¯ä¸€ä¸ªå¯æ§å˜é‡ï¼Œç”¨%00è¿›è¡Œæˆªæ–­ï¼Œä½¿ç”¨æ¡ä»¶ï¼š

```
phpç‰ˆæœ¬å°äº5.3.4
phpçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€
```

ä¸Šä¼ .pngå›¾ç‰‡

![image-20231123112643645](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123112643645.png)

ä¸Šä¼ åurlåœ°å€æ˜¯è¿™æ ·çš„

![image-20231123113120815](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123113120815.png)

æˆ‘ä»¬è®¿é—®1.phpå°±è¡Œäº†

## Pass-13(0x00ç»•è¿‡)

åŒæ ·save_pathæ˜¯å¯æ§çš„ï¼Œè¿™ä¸ªæ˜¯postè¯·æ±‚

åœ¨æ–‡ä»¶ååé¢éšä¾¿åŠ ä¸ªå­—ç¬¦ï¼Œå°†å®ƒçš„hexç¼–ç æ”¹æˆ00

![image-20231123113614521](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123113614521.png)

è®¿é—®åŒä¸Š

## Pass-14(å›¾ç‰‡ğŸ)

å‡†å¤‡phpæ–‡ä»¶(é‡Œé¢æ˜¯ä¸€å¥è¯æœ¨é©¬)ï¼Œå’Œä¸€å¼ æ™®é€šå›¾ç‰‡

```
copy 13.jpg /b + 13.php webshell.jpg
```

ä¸Šä¼ å›¾ç‰‡åï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œæ‰§è¡Œ

![image-20231123115055264](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231123115055264.png)

## Pass-15(å›¾ç‰‡ğŸ)

```
$info = getimagesize($filename);
```

getimagesize()æ˜¯PHPä¸­ç”¨äºè·å–å›¾åƒçš„å¤§å°å’Œæ ¼å¼çš„å‡½æ•°ã€‚å®ƒå¯ä»¥è¿”å›ä¸€ä¸ªåŒ…å«å›¾åƒçš„å®½åº¦ã€é«˜åº¦ã€ç±»å‹å’ŒMIMEç±»å‹çš„æ•°ç»„

getimagesize()çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

$size = getimagesize($filename);

å…¶ä¸­ï¼Œ$filenameæ˜¯è¦è·å–ä¿¡æ¯çš„å›¾åƒæ–‡ä»¶çš„è·¯å¾„ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•°ç»„$sizeï¼Œæ•°ç»„å…ƒç´ å¦‚ä¸‹ï¼š

$size[0]: å›¾åƒçš„å®½åº¦
$size[1]: å›¾åƒçš„é«˜åº¦
$size[2]: å›¾åƒçš„ç±»å‹
$size[3]: å›¾åƒçš„MIMEç±»å‹
$size[bits]: å›¾åƒçš„ä½æ·±åº¦
$size[channels]: å›¾åƒçš„é€šé“æ•°
$size[mime]: å›¾åƒçš„MIMEç±»å‹

```
Array
(
    [0] => 592
    [1] => 387
    [2] => 3 //ä¸€ä¸ªä»£è¡¨å›¾åƒç±»å‹çš„æ•´æ•°å€¼ï¼Œå¸¸é‡
    [3] => width="592" height="387"
    [bits] => 8
    [mime] => image/png
)
```

è¯¥å€¼æœ‰å¦‚ä¸‹å¸¸é‡ï¼š

IMAGETYPE_GIF: GIFæ ¼å¼
IMAGETYPE_JPEG: JPEGæ ¼å¼
IMAGETYPE_PNG: PNGæ ¼å¼

ä¸Šé¢çš„3å°±ä»£è¡¨æ˜¯pngæ ¼å¼çš„å›¾ç‰‡

åŒæ ·å›¾ç‰‡é©¬ç»•è¿‡

## Pass-16(exif_imagetype)

```
//éœ€è¦å¼€å¯php_exifæ¨¡å—
$image_type = exif_imagetype($filename);
//exif_imagetype()ä»…æ£€æŸ¥æ–‡ä»¶çš„å‰å‡ ä¸ªå­—èŠ‚ï¼Œå›¾ç‰‡ç å¯ä»¥ç»•è¿‡
```

ä¸Šä¼ åŒ…å«ä¸€å¥è¯æœ¨é©¬çš„å›¾ç‰‡ï¼Œç„¶ååˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œä»£ç 

## Pass-17(äºŒæ¬¡æ¸²æŸ“)

æœ‰äºŒæ¬¡æ¸²æŸ“å‡½æ•°

```php
imagecreatefromjpeg
imagecreatefrompng
imagecreatefromgif
```

ä¸Šä¼ å›¾ç‰‡é©¬ä¹‹åï¼Œä¼šå°†æ–‡ä»¶æœ€åçš„phpä»£ç åˆ æ‰

æˆ‘ä»¬å¯ä»¥å…ˆä¸Šä¼ å›¾ç‰‡é©¬ï¼Œç„¶åç”¨010å’Œè¢«æ¸²æŸ“çš„å›¾ç‰‡è¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾åˆ°ä¸€æ ·çš„éƒ¨åˆ†ï¼ˆæœªè¢«æ¸²æŸ“çš„éƒ¨åˆ†ï¼‰

![image-20231211201726976](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231211201726976.png)

å†ä¸Šä¼ å°±å¯ä»¥äº†

## Pass-18(æ¡ä»¶ç«äº‰)

```
unlink($upload_file); //æ–‡ä»¶ç±»å‹ä¸åˆè§„ç›´æ¥ä¼šè¢«åˆ é™¤
```

æˆ‘ä»¬å¯ä»¥å¤šå¼€å‡ ä¸ªçº¿ç¨‹ï¼Œåœ¨è¿˜æ²¡åˆ é™¤ä¹‹å‰å°±æ‰§è¡Œä»£ç 

æŠ“åŒ…ä¸Šä¼ phpæ–‡ä»¶ï¼Œå¼€ä¸¤ä¸ªçˆ†ç ´é¡µé¢ï¼Œä¸€ä¸ªå†™ï¼Œä¸€ä¸ªè¯»

![image-20231211221940410](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231211221940410.png)

![image-20231211221951213](https://dabai-1316520326.cos.ap-nanjing.myqcloud.com/img/image-20231211221951213.png)
